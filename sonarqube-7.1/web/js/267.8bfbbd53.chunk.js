(window.webpackJsonp=window.webpackJsonp||[]).push([[267],{1014:function(e,t,n){"use strict";n.d(t,"d",function(){return c}),n.d(t,"e",function(){return s}),n.d(t,"f",function(){return u}),n.d(t,"c",function(){return i}),n.d(t,"a",function(){return l}),n.d(t,"g",function(){return m}),n.d(t,"b",function(){return p});var a=n(3),r=n(13),o=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};function c(e){return Object(a.getJSON)("/api/measures/component",e).then(function(e){return e.component.measures},r.a)}function s(e,t,n){void 0===n&&(n={});var r=o({},n,{componentKey:e,metricKeys:t.join(",")});return Object(a.getJSON)("/api/measures/component",r)}function u(e,t){return Object(a.getJSON)("/api/measures/search",{projectKeys:e.join(),metricKeys:t.join()}).then(function(e){return e.measures})}function i(e){return Object(a.getJSON)("/api/custom_measures/search",e).then(function(e){return{customMeasures:e.customMeasures,paging:{pageIndex:e.p,pageSize:e.ps,total:e.total}}},r.a)}function l(e){return Object(a.postJSON)("/api/custom_measures/create",e).catch(r.a)}function m(e){return Object(a.post)("/api/custom_measures/update",e).catch(r.a)}function p(e){return Object(a.post)("/api/custom_measures/delete",e).catch(r.a)}},1161:function(e,t,n){"use strict";n.r(t);var a,r=n(0),o=n(22),c=n.n(o),s=n(256),u=n(32),i=n(51),l=n(65),m=n(11),p=n(1),d=(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),f=function(e){function t(t){var n=e.call(this,t)||this;return n.mounted=!1,n.handleSubmit=function(){return n.state.metricKey?n.props.onSubmit({description:n.state.description,metricKey:n.state.metricKey,value:n.state.value}).then(n.props.onClose):Promise.reject(void 0)},n.fetchCustomMetrics=function(){n.setState({loading:!0}),Object(s.c)({isCustom:!0}).then(function(e){n.mounted&&n.setState({loading:!1,metrics:e})},function(){n.mounted&&n.setState({loading:!1})})},n.handleMetricSelect=function(e){var t=e.value;n.setState({metricKey:t})},n.handleDescriptionChange=function(e){n.setState({description:e.currentTarget.value})},n.handleValueChange=function(e){n.setState({value:e.currentTarget.value})},n.renderMetricSelect=function(e){return e.length||n.state.loading?r.createElement("div",{className:"modal-field"},r.createElement("label",{htmlFor:"create-custom-measure-metric"},Object(p.l)("custom_measures.metric"),r.createElement("em",{className:"mandatory"},"*")),n.state.loading?r.createElement("i",{className:"spinner"}):r.createElement(i.c,{autofocus:!0,clearable:!1,onChange:n.handleMetricSelect,options:e,value:n.state.metricKey})):r.createElement("div",{className:"alert alert-warning"},Object(p.l)("custom_measures.all_metrics_taken"))},n.state={description:t.measure&&t.measure.description||"",loading:!1,metricKey:t.measure&&t.measure.metric.key,value:t.measure&&t.measure.value||""},n}return d(t,e),t.prototype.componentDidMount=function(){this.mounted=!0,this.props.measure||this.fetchCustomMetrics()},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.render=function(){var e=this,t=this.props.skipMetrics,n=void 0===t?[]:t,a=this.state.metrics,o=(void 0===a?[]:a).filter(function(e){return!n.includes(e.key)}).map(function(e){return{label:e.name,value:e.key}}),c=!this.props.measure&&!o.length;return r.createElement(l.a,{header:this.props.header,onClose:this.props.onClose,onSubmit:this.handleSubmit},function(t){var n=t.onCloseClick,a=t.onFormSubmit,s=t.submitting;return r.createElement("form",{onSubmit:a},r.createElement("header",{className:"modal-head"},r.createElement("h2",null,e.props.header)),r.createElement("div",{className:"modal-body"},!e.props.measure&&e.renderMetricSelect(o),r.createElement("div",{className:"modal-field"},r.createElement("label",{htmlFor:"create-custom-measure-value"},Object(p.l)("value"),r.createElement("em",{className:"mandatory"},"*")),r.createElement("input",{autoFocus:void 0!==e.props.measure,id:"create-custom-measure-value",maxLength:200,name:"value",onChange:e.handleValueChange,required:!0,type:"text",value:e.state.value})),r.createElement("div",{className:"modal-field"},r.createElement("label",{htmlFor:"create-custom-measure-description"},Object(p.l)("description")),r.createElement("textarea",{id:"create-custom-measure-description",name:"description",onChange:e.handleDescriptionChange,value:e.state.description}))),r.createElement("footer",{className:"modal-foot"},r.createElement(u.a,{className:"spacer-right",loading:s}),r.createElement(m.f,{disabled:c||s,id:"create-custom-measure-submit"},e.props.confirmButtonText),r.createElement(m.e,{disabled:s,id:"create-custom-measure-cancel",onClick:n},Object(p.l)("cancel"))))})},t}(r.PureComponent),h=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mounted=!1,t.state={modal:!1},t.handleClick=function(){t.setState({modal:!0})},t.handleClose=function(){t.mounted&&t.setState({modal:!1})},t}return h(t,e),t.prototype.componentDidMount=function(){this.mounted=!0},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.render=function(){return r.createElement(r.Fragment,null,r.createElement(m.a,{id:"custom-measures-create",onClick:this.handleClick},Object(p.l)("create")),this.state.modal&&r.createElement(f,{confirmButtonText:Object(p.l)("create"),header:Object(p.l)("custom_measures.create_custom_measure"),onClose:this.handleClose,onSubmit:this.props.onCreate,skipMetrics:this.props.skipMetrics}))},t}(r.PureComponent);function b(e){var t=e.loading,n=e.onCreate,a=e.skipMetrics;return r.createElement("header",{className:"page-header",id:"custom-measures-header"},r.createElement("h1",{className:"page-title"},Object(p.l)("custom_measures.page")),r.createElement(u.a,{loading:t}),r.createElement("div",{className:"page-actions"},r.createElement(g,{onCreate:n,skipMetrics:a})),r.createElement("p",{className:"page-description"},Object(p.l)("custom_measures.page.description")))}var E=n(4),v=n(79),y=n(31);function j(e){var t=e.measure,n=e.onDelete;return r.createElement(v.a,{confirmButtonText:Object(p.l)("delete"),confirmData:t.id,isDestructive:!0,modalBody:Object(p.m)("custom_measures.delete_custom_measure.confirmation",t.metric.name),modalHeader:Object(p.l)("custom_measures.delete_custom_measure"),onConfirm:n},function(e){var t=e.onClick;return r.createElement(y.b,{className:"js-custom-measure-delete",destructive:!0,onClick:t},Object(p.l)("delete"))})}var O=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),_=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mounted=!1,t.state={modal:!1},t.handleClick=function(){t.setState({modal:!0})},t.handleClose=function(){t.mounted&&t.setState({modal:!1})},t.handleSubmit=function(e){return t.props.onEdit(_({id:t.props.measure.id},e))},t}return O(t,e),t.prototype.componentDidMount=function(){this.mounted=!0},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.render=function(){return r.createElement(r.Fragment,null,r.createElement(y.b,{className:"js-custom-measure-update",onClick:this.handleClick},Object(p.l)("update_verb")),this.state.modal&&r.createElement(f,{confirmButtonText:Object(p.l)("update_verb"),header:Object(p.l)("custom_measures.update_custom_measure"),measure:this.props.measure,onClose:this.handleClose,onSubmit:this.handleSubmit}))},t}(r.PureComponent),S=n(25),N=n(50),k=n(147);function M(e){var t=e.measures,n=e.onDelete,a=e.onEdit;return r.createElement("div",{className:"boxed-group boxed-group-inner",id:"custom-measures-list"},t.length>0?r.createElement("table",{className:"data zebra zebra-hover"},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",null,Object(p.l)("custom_measures.metric")),r.createElement("th",null,Object(p.l)("value")),r.createElement("th",null,Object(p.l)("description")),r.createElement("th",null,Object(p.l)("date")),r.createElement("th",null))),r.createElement("tbody",null,Object(E.sortBy)(t,function(e){return e.metric.name.toLowerCase()}).map(function(e){return r.createElement("tr",{"data-metric":e.metric.key,key:e.id},r.createElement("td",{className:"nowrap"},r.createElement("div",null,r.createElement("span",{className:"js-custom-measure-metric-name"},e.metric.name),e.pending&&r.createElement(S.a,{overlay:Object(p.l)("custom_measures.pending_tooltip")},r.createElement("span",{className:"js-custom-measure-pending badge badge-warning spacer-left"},Object(p.l)("custom_measures.pending")))),r.createElement("span",{className:"js-custom-measure-domain note"},e.metric.domain)),r.createElement("td",{className:"nowrap"},r.createElement("strong",{className:"js-custom-measure-value"},Object(N.formatMeasure)(e.value,e.metric.type))),r.createElement("td",null,r.createElement("span",{className:"js-custom-measure-description"},e.description)),r.createElement("td",null,r.createElement(w,{measure:e})," ",Object(p.l)("by_")," ",r.createElement("span",{className:"js-custom-measure-user"},e.user.name)),r.createElement("td",{className:"thin nowrap"},r.createElement(y.c,null,r.createElement(C,{measure:e,onEdit:a}),r.createElement(y.a,null),r.createElement(j,{measure:e,onDelete:n}))))}))):r.createElement("p",null,Object(p.l)("no_results")))}function w(e){var t=e.measure;return t.updatedAt?r.createElement(r.Fragment,null,Object(p.l)("updated_on")," ",r.createElement("span",{className:"js-custom-measure-created-at"},r.createElement(k.a,{date:t.updatedAt}))):t.createdAt?r.createElement(r.Fragment,null,Object(p.l)("created_on")," ",r.createElement("span",{className:"js-custom-measure-created-at"},r.createElement(k.a,{date:t.createdAt}))):r.createElement(r.Fragment,null,Object(p.l)("created"))}var P=n(1014),D=n(78),K=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),x=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},F=50,A=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mounted=!1,t.state={loading:!0},t.fetchMeasures=function(){t.setState({loading:!0}),Object(P.c)({projectKey:t.props.component.key,ps:F}).then(function(e){var n=e.customMeasures,a=e.paging;t.mounted&&t.setState({loading:!1,measures:n,paging:a})},t.stopLoading)},t.fetchMore=function(){var e=t.state.paging;e&&(t.setState({loading:!0}),Object(P.c)({projectKey:t.props.component.key,p:e.pageIndex+1,ps:F}).then(function(e){var n=e.customMeasures,a=e.paging;t.mounted&&t.setState(function(e){var t=e.measures;return{loading:!1,measures:(void 0===t?[]:t).concat(n),paging:a}})},t.stopLoading))},t.stopLoading=function(){t.mounted&&t.setState({loading:!1})},t.handleCreate=function(e){return Object(P.a)(x({},e,{projectKey:t.props.component.key})).then(function(e){t.mounted&&t.setState(function(t){var n=t.measures,a=void 0===n?[]:n,r=t.paging;return{measures:a.concat([e]),paging:r&&x({},r,{total:r.total+1})}})})},t.handleEdit=function(e){return Object(P.g)(e).then(function(){t.mounted&&t.setState(function(t){var n=t.measures;return{measures:(void 0===n?[]:n).map(function(t){return t.id===e.id?x({},t,e):t})}})})},t.handleDelete=function(e){return Object(P.b)({id:e}).then(function(){t.mounted&&t.setState(function(t){var n=t.measures,a=void 0===n?[]:n,r=t.paging;return{measures:a.filter(function(t){return t.id!==e}),paging:r&&x({},r,{total:r.total-1})}})})},t}return K(t,e),t.prototype.componentDidMount=function(){this.mounted=!0,this.fetchMeasures()},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.render=function(){var e=this.state,t=e.loading,n=e.measures,a=e.paging;return r.createElement(r.Fragment,null,r.createElement(c.a,{title:Object(p.l)("custom_measures.page")}),r.createElement("div",{className:"page page-limited"},r.createElement(b,{loading:t,onCreate:this.handleCreate,skipMetrics:n&&n.map(function(e){return e.metric.key})}),n&&r.createElement(M,{measures:n,onDelete:this.handleDelete,onEdit:this.handleEdit}),n&&a&&r.createElement(D.a,{count:n.length,loadMore:this.fetchMore,ready:!t,total:a.total})))},t}(r.PureComponent);t.default=A}}]);
//# sourceMappingURL=267.8bfbbd53.chunk.js.map