(window.webpackJsonp=window.webpackJsonp||[]).push([[275],{1005:function(t,e,n){"use strict";n.d(e,"i",function(){return i}),n.d(e,"h",function(){return u}),n.d(e,"d",function(){return c}),n.d(e,"f",function(){return l}),n.d(e,"l",function(){return s}),n.d(e,"b",function(){return p}),n.d(e,"n",function(){return f}),n.d(e,"c",function(){return d}),n.d(e,"o",function(){return g}),n.d(e,"e",function(){return h}),n.d(e,"k",function(){return y}),n.d(e,"m",function(){return m}),n.d(e,"a",function(){return O}),n.d(e,"g",function(){return b}),n.d(e,"j",function(){return j});var a=n(3),o=n(13),r=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t};function i(t){return Object(a.getJSON)("/api/qualitygates/list",t).catch(o.a)}function u(t){return Object(a.getJSON)("/api/qualitygates/show",t).catch(o.a)}function c(t){return Object(a.postJSON)("/api/qualitygates/create",t).catch(o.a)}function l(t){return Object(a.post)("/api/qualitygates/destroy",t).catch(o.a)}function s(t){return Object(a.post)("/api/qualitygates/rename",t).catch(o.a)}function p(t){return Object(a.postJSON)("/api/qualitygates/copy",t).catch(o.a)}function f(t){return Object(a.post)("/api/qualitygates/set_as_default",t).catch(o.a)}function d(t){return Object(a.postJSON)("/api/qualitygates/create_condition",t)}function g(t){return Object(a.postJSON)("/api/qualitygates/update_condition",t)}function h(t){return Object(a.post)("/api/qualitygates/delete_condition",t)}function y(t){return Object(a.getJSON)("/api/qualitygates/get_by_project",t).then(function(t){var e=t.qualityGate;return e&&r({},e,{isDefault:e.default})},o.a)}function m(t){return Object(a.getJSON)("/api/qualitygates/search",t).catch(o.a)}function O(t){return Object(a.post)("/api/qualitygates/select",t).catch(o.a)}function b(t){return Object(a.post)("/api/qualitygates/deselect",t).catch(o.a)}function j(t){return Object(a.getJSON)("/api/qualitygates/application_status",t).catch(o.a)}},1149:function(t,e,n){"use strict";n.r(e);var a=n(0),o=n(22),r=n.n(o),i=n(1);function u(){return a.createElement("header",{className:"page-header"},a.createElement("h1",{className:"page-title"},Object(i.l)("project_quality_gate.page")),a.createElement("div",{className:"page-description"},Object(i.l)("project_quality_gate.page.description")))}var c,l=n(51),s=(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}c(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mounted=!1,e.state={loading:!1},e.stopLoading=function(){e.mounted&&e.setState({loading:!1})},e.handleChange=function(t){var n=e.props.gate,a=null==n&&null!=t.value,o=null!=n&&null==t.value,r=null!=n&&n.id!==Number(t.value);(a||o||r)&&(e.setState({loading:!0}),e.props.onChange(n&&n.id,Number(t.value)).then(e.stopLoading,e.stopLoading))},e.renderGateName=function(t){return t.isDefault?a.createElement("span",null,a.createElement("strong",null,Object(i.l)("default")),": ",t.label):a.createElement("span",null,t.label)},e}return s(e,t),e.prototype.componentDidMount=function(){this.mounted=!0},e.prototype.componentWillUnmount=function(){this.mounted=!1},e.prototype.renderSelect=function(){var t=this.props,e=t.gate,n=t.allGates.map(function(t){return{value:String(t.id),label:t.name,isDefault:t.isDefault}});return a.createElement(l.c,{clearable:!1,disabled:this.state.loading,onChange:this.handleChange,optionRenderer:this.renderGateName,options:n,style:{width:300},value:e&&String(e.id),valueRenderer:this.renderGateName})},e.prototype.render=function(){return a.createElement("div",null,this.renderSelect(),this.state.loading&&a.createElement("i",{className:"spinner spacer-left"}))},e}(a.PureComponent),f=n(1005),d=n(264),g=n(119),h=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function a(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mounted=!1,e.state={loading:!0},e.handleChangeGate=function(t,n){var a=e.state.allGates;if(!t&&!n||!a)return Promise.resolve();var o=e.props.component,r={gateId:n||t,organization:o.organization,projectKey:o.key};return(n?Object(f.a)(r):Object(f.g)(r)).then(function(){if(e.mounted)if(Object(d.a)(Object(i.l)("project_quality_gate.successfully_updated")),n){var t=a.find(function(t){return t.id===n});t&&(e.setState({gate:t}),e.props.onComponentChange({qualityGate:t}))}else e.setState({gate:void 0})})},e}return h(e,t),e.prototype.componentDidMount=function(){this.mounted=!0,this.checkPermissions()?this.fetchQualityGates():Object(g.default)()},e.prototype.componentWillUnmount=function(){this.mounted=!1},e.prototype.checkPermissions=function(){var t=this.props.component.configuration;return!!(t&&t.showQualityGates)},e.prototype.fetchQualityGates=function(){var t=this,e=this.props.component;this.setState({loading:!0}),Promise.all([Object(f.i)({organization:e.organization}),Object(f.k)({organization:e.organization,project:e.key})]).then(function(e){var n=e[0].qualitygates,a=e[1];t.mounted&&t.setState({allGates:n,gate:a,loading:!1})},function(){t.mounted&&t.setState({loading:!1})})},e.prototype.render=function(){if(!this.checkPermissions())return null;var t=this.state,e=t.allGates,n=t.gate,o=t.loading;return a.createElement("div",{id:"project-quality-gate",className:"page page-limited"},a.createElement(r.a,{title:Object(i.l)("project_quality_gate.page")}),a.createElement(u,null),o?a.createElement("i",{className:"spinner"}):e&&a.createElement(p,{allGates:e,gate:n,onChange:this.handleChangeGate}))},e}(a.PureComponent);e.default=y}}]);
//# sourceMappingURL=275.df5b98d4.chunk.js.map