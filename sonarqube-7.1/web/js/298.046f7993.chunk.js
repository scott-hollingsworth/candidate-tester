(window.webpackJsonp=window.webpackJsonp||[]).push([[298],{1160:function(e,o,t){"use strict";t.r(o);var n,r=t(10),i=t(0),s=t.n(i),a=t(22),p=t.n(a),l=t(4),c=t(178),u=t(176),m=t(1),d=t(279),h=(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o}||function(e,o){for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t])},function(e,o){function t(){this.constructor=e}n(e,o),e.prototype=null===o?Object.create(o):(t.prototype=o.prototype,new t)}),f=function(e){function o(){var o=null!==e&&e.apply(this,arguments)||this;return o.handleToggleUser=function(e,t){return e.permissions.includes(t)?o.props.revokePermissionFromUser(e.login,t):o.props.grantPermissionToUser(e.login,t)},o.handleToggleGroup=function(e,t){return e.permissions.includes(t)?o.props.revokePermissionFromGroup(e.name,t):o.props.grantPermissionToGroup(e.name,t)},o.handleSelectPermission=function(e){o.props.onPermissionSelect(e)},o}return h(o,e),o.prototype.render=function(){var e=d.a[this.props.component.qualifier];"public"===this.props.visibility&&(e=Object(l.without)(e,"user","codeviewer"));var o=e.map(function(e){return{key:e,name:Object(m.l)("projects_role",e),description:Object(m.l)("projects_role",e,"desc")}});return s.a.createElement(u.a,{groups:this.props.groups,onSelectPermission:this.handleSelectPermission,onToggleGroup:this.handleToggleGroup,onToggleUser:this.handleToggleUser,permissions:o,selectedPermission:this.props.selectedPermission,users:this.props.users},s.a.createElement(c.a,{filter:this.props.filter,onFilter:this.props.onFilterChange,onSearch:this.props.onQueryChange,query:this.props.query}))},o}(s.a.PureComponent),g=t(278),y=t(11),P=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o}||function(e,o){for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t])};return function(o,t){function n(){this.constructor=o}e(o,t),o.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),v=function(e){function o(){var o=null!==e&&e.apply(this,arguments)||this;return o.mounted=!1,o.state={applyTemplateModal:!1},o.handleApplyTemplate=function(){o.setState({applyTemplateModal:!0})},o.handleApplyTemplateClose=function(){o.mounted&&o.setState({applyTemplateModal:!1})},o}return P(o,e),o.prototype.componentDidMount=function(){this.mounted=!0},o.prototype.componentWillUnmount=function(){this.mounted=!1},o.prototype.render=function(){var e=this.props.component,o=e.configuration,t=null!=o&&o.canApplyPermissionTemplate,n=["VW","SVW","APP"].includes(e.qualifier)?Object(m.l)("roles.page.description_portfolio"):Object(m.l)("roles.page.description2"),r="TRK"===e.qualifier&&e.visibility?Object(m.l)("visibility",e.visibility,"description",e.qualifier):null;return i.createElement("header",{className:"page-header"},i.createElement("h1",{className:"page-title"},Object(m.l)("permissions.page")),this.props.loading&&i.createElement("i",{className:"spinner"}),t&&i.createElement("div",{className:"page-actions"},i.createElement(y.a,{className:"js-apply-template",onClick:this.handleApplyTemplate},Object(m.l)("projects_role.apply_template")),this.state.applyTemplateModal&&i.createElement(g.a,{onApply:this.props.loadHolders,onClose:this.handleApplyTemplateClose,organization:e.organization,project:e})),i.createElement("div",{className:"page-description"},i.createElement("p",null,n),null!=r&&i.createElement("p",null,r)))},o}(i.PureComponent),b=t(20),_=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o}||function(e,o){for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t])};return function(o,t){function n(){this.constructor=o}e(o,t),o.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),j=function(e){function o(){var o=null!==e&&e.apply(this,arguments)||this;return o.handleCancelClick=function(e){e.preventDefault(),o.props.onClose()},o.handleConfirmClick=function(e){e.preventDefault(),o.props.onConfirm(),o.props.onClose()},o}return _(o,e),o.prototype.render=function(){var e=this.props.component.qualifier;return s.a.createElement(b.a,{contentLabel:"modal form",onRequestClose:this.props.onClose},s.a.createElement("header",{className:"modal-head"},s.a.createElement("h2",null,Object(m.m)("projects_role.turn_x_to_public",this.props.component.name))),s.a.createElement("div",{className:"modal-body"},s.a.createElement("p",null,Object(m.l)("projects_role.are_you_sure_to_turn_project_to_public",e)),s.a.createElement("p",{className:"spacer-top"},Object(m.l)("projects_role.are_you_sure_to_turn_project_to_public.2",e))),s.a.createElement("footer",{className:"modal-foot"},s.a.createElement("button",{id:"confirm-turn-to-public",onClick:this.handleConfirmClick},Object(m.l)("projects_role.turn_project_to_public",e)),s.a.createElement("a",{href:"#",onClick:this.handleCancelClick},Object(m.l)("cancel"))))},o}(s.a.PureComponent),C=t(177),O=t(277),T=t(280),E=t(21),S=(t(268),function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o}||function(e,o){for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t])};return function(o,t){function n(){this.constructor=o}e(o,t),o.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}()),F=Object.assign||function(e){for(var o,t=1,n=arguments.length;t<n;t++)for(var r in o=arguments[t])Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r]);return e},k=function(e){function o(o){var t=e.call(this,o)||this;return t.stopLoading=function(){t.mounted&&t.setState({loading:!1})},t.loadHolders=function(){if(t.mounted){t.setState({loading:!0});var e=t.props.component,o=t.state,n=o.filter,r=o.query,i=o.selectedPermission,s="groups"!==n?E.m(e.key,r,i,e.organization):Promise.resolve([]),a="users"!==n?E.l(e.key,r,i,e.organization):Promise.resolve([]);Promise.all([s,a]).then(function(e){t.mounted&&t.setState({loading:!1,groups:e[1],users:e[0]})},function(e){t.mounted&&(t.props.onRequestFail(e),t.setState({loading:!1}))})}},t.handleFilterChange=function(e){t.mounted&&t.setState({filter:e},t.loadHolders)},t.handleQueryChange=function(e){t.mounted&&t.setState({query:e},t.loadHolders)},t.handlePermissionSelect=function(e){t.mounted&&t.setState(function(o){return{selectedPermission:o.selectedPermission===e?void 0:e}},t.loadHolders)},t.addPermissionToGroup=function(e,o){return t.state.groups.map(function(t){return t.name===e?F({},t,{permissions:t.permissions.concat([o])}):t})},t.addPermissionToUser=function(e,o){return t.state.users.map(function(t){return t.login===e?F({},t,{permissions:t.permissions.concat([o])}):t})},t.removePermissionFromGroup=function(e,o){return t.state.groups.map(function(t){return t.name===e?F({},t,{permissions:Object(l.without)(t.permissions,o)}):t})},t.removePermissionFromUser=function(e,o){return t.state.users.map(function(t){return t.login===e?F({},t,{permissions:Object(l.without)(t.permissions,o)}):t})},t.grantPermissionToGroup=function(e,o){return t.mounted?(t.setState({loading:!0,groups:t.addPermissionToGroup(e,o)}),E.n(t.props.component.key,e,o,t.props.component.organization).then(t.stopLoading,function(n){t.mounted&&(t.setState({loading:!1,groups:t.removePermissionFromGroup(e,o)}),t.props.onRequestFail(n))})):Promise.resolve()},t.grantPermissionToUser=function(e,o){return t.mounted?(t.setState({loading:!0,users:t.addPermissionToUser(e,o)}),E.o(t.props.component.key,e,o,t.props.component.organization).then(t.stopLoading,function(n){t.mounted&&(t.setState({loading:!1,users:t.removePermissionFromUser(e,o)}),t.props.onRequestFail(n))})):Promise.resolve()},t.revokePermissionFromGroup=function(e,o){return t.mounted?(t.setState({loading:!0,groups:t.removePermissionFromGroup(e,o)}),E.s(t.props.component.key,e,o,t.props.component.organization).then(t.stopLoading,function(n){t.mounted&&(t.setState({loading:!1,groups:t.addPermissionToGroup(e,o)}),t.props.onRequestFail(n))})):Promise.resolve()},t.revokePermissionFromUser=function(e,o){return t.mounted?(t.setState({loading:!0,users:t.removePermissionFromUser(e,o)}),E.t(t.props.component.key,e,o,t.props.component.organization).then(t.stopLoading,function(n){t.mounted&&(t.setState({loading:!1,users:t.addPermissionToUser(e,o)}),t.props.onRequestFail(n))})):Promise.resolve()},t.handleVisibilityChange=function(e){"public"===e?t.openDisclaimer():t.turnProjectToPrivate()},t.turnProjectToPublic=function(){t.props.onComponentChange({visibility:"public"}),E.d(t.props.component.key,"public").then(function(){t.loadHolders()},function(e){t.props.onComponentChange({visibility:"private"}),t.props.onRequestFail(e)})},t.turnProjectToPrivate=function(){t.props.onComponentChange({visibility:"private"}),E.d(t.props.component.key,"private").then(function(){t.loadHolders()},function(e){t.props.onComponentChange({visibility:"public"}),t.props.onRequestFail(e)})},t.openDisclaimer=function(){t.mounted&&t.setState({disclaimer:!0})},t.closeDisclaimer=function(){t.mounted&&t.setState({disclaimer:!1})},t.state={disclaimer:!1,filter:"all",groups:[],loading:!0,query:"",users:[]},t}return S(o,e),o.prototype.componentDidMount=function(){this.mounted=!0,this.loadHolders()},o.prototype.componentWillUnmount=function(){this.mounted=!1},o.prototype.render=function(){var e=null!=this.props.component.configuration&&this.props.component.configuration.canUpdateProjectVisibilityToPrivate;return s.a.createElement("div",{className:"page page-limited",id:"project-permissions-page"},s.a.createElement(p.a,{title:Object(m.l)("permissions.page")}),s.a.createElement(v,{component:this.props.component,loading:this.state.loading,loadHolders:this.loadHolders}),s.a.createElement(T.a,null),s.a.createElement("div",null,s.a.createElement(O.a,{canTurnToPrivate:e,className:"big-spacer-top big-spacer-bottom",onChange:this.handleVisibilityChange,visibility:this.props.component.visibility}),"TRK"===this.props.component.qualifier&&!e&&s.a.createElement(C.a,{organization:this.props.component.organization}),this.state.disclaimer&&s.a.createElement(j,{component:this.props.component,onClose:this.closeDisclaimer,onConfirm:this.turnProjectToPublic})),s.a.createElement(f,{component:this.props.component,filter:this.state.filter,grantPermissionToGroup:this.grantPermissionToGroup,grantPermissionToUser:this.grantPermissionToUser,groups:this.state.groups,onFilterChange:this.handleFilterChange,onPermissionSelect:this.handlePermissionSelect,onQueryChange:this.handleQueryChange,query:this.state.query,revokePermissionFromGroup:this.revokePermissionFromGroup,revokePermissionFromUser:this.revokePermissionFromUser,selectedPermission:this.state.selectedPermission,users:this.state.users,visibility:this.props.component.visibility}))},o}(s.a.PureComponent),q=t(43),U=t(7);o.default=Object(r.connect)(function(e){return{currentUser:Object(U.getCurrentUser)(e)}},function(e){return{onRequestFail:Object(q.g)(e)}})(k)}}]);
//# sourceMappingURL=298.046f7993.chunk.js.map