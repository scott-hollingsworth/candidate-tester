{"version":3,"sources":["webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/ComponentSourceSnippetViewer.tsx","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/CrossComponentSourceViewerWrapper.tsx","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/utils.ts","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.tsx","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.css?6bd4","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.css"],"names":["ComponentSourceSnippetViewer_ComponentSourceSnippetViewer","index_js_exposed","[object Object]","this","mounted","rootNodeRef","state","additionalLines","highlightedSymbols","loading","openIssuesByLine","snippets","expandBlock","snippetIndex","direction","_this$props","props","branchLike","key","snippetGroup","component","snippet","find","s","index","Promise","reject","extension","utils","range","from","Math","max","start","to","end","Object","api_components","_objectSpread","branch_like","then","lines","reduce","lineMap","line","coverageStatus","getCoverageStatus","newLinesMapped","animateBlockExpansion","expandComponent","_this$props2","setState","_ref","length","handleLinePopupToggle","linePopup","onLinePopupToggle","handleOpenIssues","handleCloseIssues","handleSymbolClick","loadDuplications","renderDuplicationPopup","createSnippetsFromProps","locations","issue","addIssueLocation","secondaryLocations","root","current","element","querySelector","concat","wrapper","table","firstChild","nodes","getNodes","style","marginTop","maxHeight","value","up","arguments","undefined","getBoundingClientRect","height","startHeight","transition","setTimeout","newSnippets","deletedSnippets","filter","toDelete","forEach","setMaxHeight","resolve","_ref2","cleanDom","_ref3","issuesByLine","last","locationsByLine","SnippetViewer","highlightedLocationMessage","issuePopup","onIssueChange","onIssuePopupToggle","onLocationSelect","scroll","_this$props3","duplications","_this$state","indexing","fullyShown","measures","parseInt","snippetLines","sources","className","classnames","source-duplications-expanded","ref","SourceViewerHeaderSlim","expandable","onExpand","sourceViewerFile","map","id","renderSnippet","CrossComponentSourceViewerWrapper_CrossComponentSourceViewerWrapper","components","duplicationsByLine","notAccessible","fetchDuplications","CrossComponentSourceViewerWrapper_objectSpread","r","duplicatedFiles","files","name","handleIssuePopupToggle","popupName","open","samePopup","handleCloseLinePopup","blocks","helpers_duplications","context","Consumer","openComponent","DuplicationPopup","inRemovedComponent","onClose","fetchIssueFlowSnippets","newProps","issueKey","issues","onLoaded","response","status","throwGlobalError","_this$state2","DeferredSpinner_default","a","Alert","variant","l10n","_this$state3","issuesByComponent","locationsByComponent","i","componentProps","SourceViewerContext","Provider","selectedFlowIndex","file","assign","LINES_ABOVE","LINES_BELOW","MERGE_DISTANCE","LINES_BELOW_ISSUE","EXPAND_BY_LINES","collision","_slicedToArray","startA","endA","_ref4","startB","getPrimaryLocation","textRange","endLine","endOffset","startLine","startOffset","createSnippets","params","loc","startIndex","endIndex","locationEnd","issueEndLine","addLinesBellow","firstCollision","keep","min","push","linesForSnippets","componentLines","groupLocationsByComponent","currentGroup","currentComponent","groups","path","project","projectName","q","uuid","unknownComponent","expandSnippet","_ref5","snippetToExpand","Error","inSnippet","__webpack_require__","d","__webpack_exports__","classnames__WEBPACK_IMPORTED_MODULE_0__","classnames__WEBPACK_IMPORTED_MODULE_0___default","n","react__WEBPACK_IMPORTED_MODULE_1__","sonar_ui_common_components_icons_ExpandSnippetIcon__WEBPACK_IMPORTED_MODULE_2__","sonar_ui_common_components_icons_ExpandSnippetIcon__WEBPACK_IMPORTED_MODULE_2___default","sonar_ui_common_helpers_l10n__WEBPACK_IMPORTED_MODULE_3__","sonar_ui_common_helpers_scrolling__WEBPACK_IMPORTED_MODULE_4__","_components_SourceViewer_components_Line__WEBPACK_IMPORTED_MODULE_5__","_components_SourceViewer_helpers_indexing__WEBPACK_IMPORTED_MODULE_6__","_components_SourceViewer_helpers_issueLocations__WEBPACK_IMPORTED_MODULE_7__","_components_SourceViewer_helpers_lines__WEBPACK_IMPORTED_MODULE_8__","_utils__WEBPACK_IMPORTED_MODULE_10__","SCROLL_LEFT_OFFSET","super","doScroll","parent","snippetNodeRef","leftOffset","rightOffset","width","scrollToLastExpandedRow","snippetNode","rows","querySelectorAll","lastRow","displayDuplications","displaySCM","issuesForLine","issueLocations","symbols","verticalBuffer","secondaryIssueLocations","duplicationsCount","lineDuplications","isSinkLine","some","displayAllIssues","displayCoverage","displayIssues","displayLocationMarkers","highlighted","onIssueSelect","onIssueUnselect","onIssuesClose","onIssuesOpen","onSymbolClick","openIssues","previousLine","selectedIssue","_this$props2$issuesBy","lastLine","bottomLine","issueLine","lowestVisibleIssue","keys","k","l","duplicated","aria-label","onClick","type","expand-up","expand-down","renderLine","content","module","options","hmr","transform","insertInto","locals","exports"],"mappings":"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","file":"js/345.m.69a2dbd3.chunk.js","sourcesContent":["/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport { getSources } from '../../../api/components';\nimport getCoverageStatus from '../../../components/SourceViewer/helpers/getCoverageStatus';\nimport { locationsByLine } from '../../../components/SourceViewer/helpers/indexing';\nimport SourceViewerHeaderSlim from '../../../components/SourceViewer/SourceViewerHeaderSlim';\nimport { getBranchLikeQuery } from '../../../helpers/branch-like';\nimport { BranchLike } from '../../../types/branch-like';\nimport SnippetViewer from './SnippetViewer';\nimport {\n  createSnippets,\n  expandSnippet,\n  EXPAND_BY_LINES,\n  linesForSnippets,\n  MERGE_DISTANCE\n} from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  duplications?: T.Duplication[];\n  duplicationsByLine?: { [line: number]: number[] };\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined;\n  issue: T.Issue;\n  issuePopup?: { issue: string; name: string };\n  issuesByLine: T.IssuesByLine;\n  last: boolean;\n  linePopup?: T.LinePopup;\n  loadDuplications: (component: string, line: T.SourceLine) => void;\n  locations: T.FlowLocation[];\n  onIssueChange: (issue: T.Issue) => void;\n  onIssuePopupToggle: (issue: string, popupName: string, open?: boolean) => void;\n  onLinePopupToggle: (linePopup: T.LinePopup & { component: string }) => void;\n  onLocationSelect: (index: number) => void;\n  renderDuplicationPopup: (\n    component: T.SourceViewerFile,\n    index: number,\n    line: number\n  ) => React.ReactNode;\n  scroll?: (element: HTMLElement, offset: number) => void;\n  snippetGroup: T.SnippetGroup;\n}\n\ninterface State {\n  additionalLines: { [line: number]: T.SourceLine };\n  highlightedSymbols: string[];\n  loading: boolean;\n  openIssuesByLine: T.Dict<boolean>;\n  snippets: T.Snippet[];\n}\n\nexport default class ComponentSourceSnippetViewer extends React.PureComponent<Props, State> {\n  mounted = false;\n  rootNodeRef = React.createRef<HTMLDivElement>();\n  state: State = {\n    additionalLines: {},\n    highlightedSymbols: [],\n    loading: false,\n    openIssuesByLine: {},\n    snippets: []\n  };\n\n  componentDidMount() {\n    this.mounted = true;\n    this.createSnippetsFromProps();\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  createSnippetsFromProps() {\n    const snippets = createSnippets({\n      locations: this.props.snippetGroup.locations,\n      issue: this.props.issue,\n      addIssueLocation: this.props.issue.secondaryLocations.length > 0\n    });\n\n    this.setState({ snippets });\n  }\n\n  getNodes(index: number): { wrapper: HTMLElement; table: HTMLElement } | undefined {\n    const root = this.rootNodeRef.current;\n    if (!root) {\n      return undefined;\n    }\n    const element = root.querySelector(`#snippet-wrapper-${index}`);\n    if (!element) {\n      return undefined;\n    }\n    const wrapper = element.querySelector<HTMLElement>('.snippet');\n    if (!wrapper) {\n      return undefined;\n    }\n    const table = wrapper.firstChild as HTMLElement;\n    if (!table) {\n      return undefined;\n    }\n\n    return { wrapper, table };\n  }\n\n  /*\n   * Clean after animation\n   */\n  cleanDom(index: number) {\n    const nodes = this.getNodes(index);\n\n    if (!nodes) {\n      return;\n    }\n\n    const { wrapper, table } = nodes;\n\n    table.style.marginTop = '';\n    wrapper.style.maxHeight = '';\n  }\n\n  setMaxHeight(index: number, value?: number, up = false) {\n    const nodes = this.getNodes(index);\n\n    if (!nodes) {\n      return;\n    }\n\n    const { wrapper, table } = nodes;\n\n    const maxHeight = value !== undefined ? value : table.getBoundingClientRect().height;\n\n    if (up) {\n      const startHeight = wrapper.getBoundingClientRect().height;\n      table.style.transition = 'none';\n      table.style.marginTop = `${startHeight - maxHeight}px`;\n\n      // animate!\n      setTimeout(() => {\n        table.style.transition = '';\n        table.style.marginTop = '0px';\n        wrapper.style.maxHeight = `${maxHeight + 20}px`;\n      }, 0);\n    } else {\n      wrapper.style.maxHeight = `${maxHeight + 20}px`;\n    }\n  }\n\n  expandBlock = (snippetIndex: number, direction: T.ExpandDirection): Promise<void> => {\n    const { branchLike, snippetGroup } = this.props;\n    const { key } = snippetGroup.component;\n    const { snippets } = this.state;\n    const snippet = snippets.find(s => s.index === snippetIndex);\n    if (!snippet) {\n      return Promise.reject();\n    }\n    // Extend by EXPAND_BY_LINES and add buffer for merging snippets\n    const extension = EXPAND_BY_LINES + MERGE_DISTANCE - 1;\n    const range =\n      direction === 'up'\n        ? {\n            from: Math.max(1, snippet.start - extension),\n            to: snippet.start - 1\n          }\n        : {\n            from: snippet.end + 1,\n            to: snippet.end + extension\n          };\n    return getSources({\n      key,\n      ...range,\n      ...getBranchLikeQuery(branchLike)\n    })\n      .then(lines =>\n        lines.reduce((lineMap: T.Dict<T.SourceLine>, line) => {\n          line.coverageStatus = getCoverageStatus(line);\n          lineMap[line.line] = line;\n          return lineMap;\n        }, {})\n      )\n      .then(newLinesMapped => this.animateBlockExpansion(snippetIndex, direction, newLinesMapped));\n  };\n\n  animateBlockExpansion(\n    snippetIndex: number,\n    direction: T.ExpandDirection,\n    newLinesMapped: T.Dict<T.SourceLine>\n  ): Promise<void> {\n    if (this.mounted) {\n      const { snippets } = this.state;\n\n      const newSnippets = expandSnippet({\n        direction,\n        snippetIndex,\n        snippets\n      });\n\n      const deletedSnippets = newSnippets.filter(s => s.toDelete);\n\n      // set max-height to current height for CSS transitions\n      deletedSnippets.forEach(s => this.setMaxHeight(s.index));\n      this.setMaxHeight(snippetIndex);\n\n      return new Promise(resolve => {\n        this.setState(\n          ({ additionalLines, snippets }) => {\n            const combinedLines = { ...additionalLines, ...newLinesMapped };\n            return {\n              additionalLines: combinedLines,\n              snippets\n            };\n          },\n          () => {\n            // Set max-height 0 to trigger CSS transitions\n            deletedSnippets.forEach(s => {\n              this.setMaxHeight(s.index, 0);\n            });\n            this.setMaxHeight(snippetIndex, undefined, direction === 'up');\n\n            // Wait for transition to finish before updating dom\n            setTimeout(() => {\n              this.setState({ snippets: newSnippets.filter(s => !s.toDelete) }, resolve);\n              this.cleanDom(snippetIndex);\n            }, 200);\n          }\n        );\n      });\n    }\n    return Promise.resolve();\n  }\n\n  expandComponent = () => {\n    const { branchLike, snippetGroup } = this.props;\n    const { key } = snippetGroup.component;\n\n    this.setState({ loading: true });\n\n    getSources({ key, ...getBranchLikeQuery(branchLike) }).then(\n      lines => {\n        if (this.mounted) {\n          this.setState(({ additionalLines }) => {\n            const combinedLines = { ...additionalLines, ...lines };\n            return {\n              additionalLines: combinedLines,\n              loading: false,\n              snippets: [{ start: 0, end: lines[lines.length - 1].line, index: -1 }]\n            };\n          });\n        }\n      },\n      () => {\n        if (this.mounted) {\n          this.setState({ loading: false });\n        }\n      }\n    );\n  };\n\n  handleLinePopupToggle = (linePopup: T.LinePopup) => {\n    this.props.onLinePopupToggle({\n      ...linePopup,\n      component: this.props.snippetGroup.component.key\n    });\n  };\n\n  handleOpenIssues = (line: T.SourceLine) => {\n    this.setState(state => ({\n      openIssuesByLine: { ...state.openIssuesByLine, [line.line]: true }\n    }));\n  };\n\n  handleCloseIssues = (line: T.SourceLine) => {\n    this.setState(state => ({\n      openIssuesByLine: { ...state.openIssuesByLine, [line.line]: false }\n    }));\n  };\n\n  handleSymbolClick = (highlightedSymbols: string[]) => {\n    this.setState({ highlightedSymbols });\n  };\n\n  loadDuplications = (line: T.SourceLine) => {\n    this.props.loadDuplications(this.props.snippetGroup.component.key, line);\n  };\n\n  renderDuplicationPopup = (index: number, line: number) => {\n    return this.props.renderDuplicationPopup(this.props.snippetGroup.component, index, line);\n  };\n\n  renderSnippet({\n    index,\n    issuesByLine,\n    last,\n    locationsByLine,\n    snippet\n  }: {\n    index: number;\n    issuesByLine: T.IssuesByLine;\n    last: boolean;\n    locationsByLine: { [line: number]: T.LinearIssueLocation[] };\n    snippet: T.SourceLine[];\n  }) {\n    return (\n      <SnippetViewer\n        branchLike={this.props.branchLike}\n        component={this.props.snippetGroup.component}\n        expandBlock={this.expandBlock}\n        handleCloseIssues={this.handleCloseIssues}\n        handleLinePopupToggle={this.handleLinePopupToggle}\n        handleOpenIssues={this.handleOpenIssues}\n        handleSymbolClick={this.handleSymbolClick}\n        highlightedLocationMessage={this.props.highlightedLocationMessage}\n        highlightedSymbols={this.state.highlightedSymbols}\n        index={index}\n        issue={this.props.issue}\n        issuePopup={this.props.issuePopup}\n        issuesByLine={issuesByLine}\n        last={last}\n        linePopup={this.props.linePopup}\n        loadDuplications={this.loadDuplications}\n        locations={this.props.locations}\n        locationsByLine={locationsByLine}\n        onIssueChange={this.props.onIssueChange}\n        onIssuePopupToggle={this.props.onIssuePopupToggle}\n        onLocationSelect={this.props.onLocationSelect}\n        openIssuesByLine={this.state.openIssuesByLine}\n        renderDuplicationPopup={this.renderDuplicationPopup}\n        scroll={this.props.scroll}\n        snippet={snippet}\n      />\n    );\n  }\n\n  render() {\n    const { branchLike, duplications, issue, issuesByLine, last, snippetGroup } = this.props;\n    const { additionalLines, loading, snippets } = this.state;\n    const locations = locationsByLine([issue]);\n\n    const fullyShown =\n      snippets.length === 1 &&\n      snippetGroup.component.measures &&\n      snippets[0].end - snippets[0].start ===\n        parseInt(snippetGroup.component.measures.lines || '', 10);\n\n    const snippetLines = linesForSnippets(snippets, {\n      ...snippetGroup.sources,\n      ...additionalLines\n    });\n\n    return (\n      <div\n        className={classNames('component-source-container', {\n          'source-duplications-expanded': duplications && duplications.length > 0\n        })}\n        ref={this.rootNodeRef}>\n        <SourceViewerHeaderSlim\n          branchLike={branchLike}\n          expandable={!fullyShown}\n          loading={loading}\n          onExpand={this.expandComponent}\n          sourceViewerFile={snippetGroup.component}\n        />\n        {snippetLines.map((snippet, index) => (\n          <div id={`snippet-wrapper-${snippets[index].index}`} key={snippets[index].index}>\n            {this.renderSnippet({\n              snippet,\n              index: snippets[index].index,\n              issuesByLine: last ? issuesByLine : {},\n              locationsByLine: last && index === snippets.length - 1 ? locations : {},\n              last: last && index === snippets.length - 1\n            })}\n          </div>\n        ))}\n      </div>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { Alert } from 'sonar-ui-common/components/ui/Alert';\nimport DeferredSpinner from 'sonar-ui-common/components/ui/DeferredSpinner';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { getDuplications } from '../../../api/components';\nimport { getIssueFlowSnippets } from '../../../api/issues';\nimport throwGlobalError from '../../../app/utils/throwGlobalError';\nimport DuplicationPopup from '../../../components/SourceViewer/components/DuplicationPopup';\nimport {\n  filterDuplicationBlocksByLine,\n  getDuplicationBlocksForIndex,\n  isDuplicationBlockInRemovedComponent\n} from '../../../components/SourceViewer/helpers/duplications';\nimport {\n  duplicationsByLine,\n  issuesByComponentAndLine\n} from '../../../components/SourceViewer/helpers/indexing';\nimport { SourceViewerContext } from '../../../components/SourceViewer/SourceViewerContext';\nimport { WorkspaceContext } from '../../../components/workspace/context';\nimport { getBranchLikeQuery } from '../../../helpers/branch-like';\nimport { BranchLike } from '../../../types/branch-like';\nimport ComponentSourceSnippetViewer from './ComponentSourceSnippetViewer';\nimport { groupLocationsByComponent } from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  highlightedLocationMessage?: { index: number; text: string | undefined };\n  issue: T.Issue;\n  issues: T.Issue[];\n  locations: T.FlowLocation[];\n  onIssueChange: (issue: T.Issue) => void;\n  onLoaded?: () => void;\n  onLocationSelect: (index: number) => void;\n  scroll?: (element: HTMLElement) => void;\n  selectedFlowIndex: number | undefined;\n}\n\ninterface State {\n  components: T.Dict<T.SnippetsByComponent>;\n  duplicatedFiles?: T.Dict<T.DuplicatedFile>;\n  duplications?: T.Duplication[];\n  duplicationsByLine: { [line: number]: number[] };\n  issuePopup?: { issue: string; name: string };\n  linePopup?: T.LinePopup & { component: string };\n  loading: boolean;\n  notAccessible: boolean;\n}\n\nexport default class CrossComponentSourceViewerWrapper extends React.PureComponent<Props, State> {\n  mounted = false;\n  state: State = {\n    components: {},\n    duplicationsByLine: {},\n    loading: true,\n    notAccessible: false\n  };\n\n  componentDidMount() {\n    this.mounted = true;\n    this.fetchIssueFlowSnippets(this.props.issue.key);\n  }\n\n  componentWillReceiveProps(newProps: Props) {\n    if (newProps.issue.key !== this.props.issue.key) {\n      this.fetchIssueFlowSnippets(newProps.issue.key);\n    }\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  fetchDuplications = (component: string, line: T.SourceLine) => {\n    getDuplications({\n      key: component,\n      ...getBranchLikeQuery(this.props.branchLike)\n    }).then(\n      r => {\n        if (this.mounted) {\n          this.setState(state => ({\n            duplicatedFiles: r.files,\n            duplications: r.duplications,\n            duplicationsByLine: duplicationsByLine(r.duplications),\n            linePopup:\n              r.duplications.length === 1\n                ? { component, index: 0, line: line.line, name: 'duplications' }\n                : state.linePopup\n          }));\n        }\n      },\n      () => {}\n    );\n  };\n\n  fetchIssueFlowSnippets(issueKey: string) {\n    this.setState({ loading: true });\n    getIssueFlowSnippets(issueKey).then(\n      components => {\n        if (this.mounted) {\n          this.setState({\n            components,\n            issuePopup: undefined,\n            linePopup: undefined,\n            loading: false\n          });\n          if (this.props.onLoaded) {\n            this.props.onLoaded();\n          }\n        }\n      },\n      (response: Response) => {\n        if (response.status !== 403) {\n          throwGlobalError(response);\n        }\n        if (this.mounted) {\n          this.setState({ loading: false, notAccessible: response.status === 403 });\n        }\n      }\n    );\n  }\n\n  handleIssuePopupToggle = (issue: string, popupName: string, open?: boolean) => {\n    this.setState((state: State) => {\n      const samePopup =\n        state.issuePopup && state.issuePopup.name === popupName && state.issuePopup.issue === issue;\n      if (open !== false && !samePopup) {\n        return { issuePopup: { issue, name: popupName } };\n      } else if (open !== true && samePopup) {\n        return { issuePopup: undefined };\n      }\n      return null;\n    });\n  };\n\n  handleLinePopupToggle = ({\n    component,\n    index,\n    line,\n    name,\n    open\n  }: T.LinePopup & { component: string }) => {\n    this.setState((state: State) => {\n      const samePopup =\n        state.linePopup !== undefined &&\n        state.linePopup.line === line &&\n        state.linePopup.name === name &&\n        state.linePopup.component === component &&\n        state.linePopup.index === index;\n      if (open !== false && !samePopup) {\n        return { linePopup: { component, index, line, name } };\n      } else if (open !== true && samePopup) {\n        return { linePopup: undefined };\n      }\n      return null;\n    });\n  };\n\n  handleCloseLinePopup = () => {\n    this.setState({ linePopup: undefined });\n  };\n\n  renderDuplicationPopup = (component: T.SourceViewerFile, index: number, line: number) => {\n    const { duplicatedFiles, duplications } = this.state;\n\n    if (!component || !duplicatedFiles) {\n      return null;\n    }\n\n    const blocks = getDuplicationBlocksForIndex(duplications, index);\n\n    return (\n      <WorkspaceContext.Consumer>\n        {({ openComponent }) => (\n          <DuplicationPopup\n            blocks={filterDuplicationBlocksByLine(blocks, line)}\n            branchLike={this.props.branchLike}\n            duplicatedFiles={duplicatedFiles}\n            inRemovedComponent={isDuplicationBlockInRemovedComponent(blocks)}\n            onClose={this.handleCloseLinePopup}\n            openComponent={openComponent}\n            sourceViewerFile={component}\n          />\n        )}\n      </WorkspaceContext.Consumer>\n    );\n  };\n\n  render() {\n    const { loading, notAccessible } = this.state;\n\n    if (loading) {\n      return (\n        <div>\n          <DeferredSpinner />\n        </div>\n      );\n    }\n\n    if (notAccessible) {\n      return (\n        <Alert className=\"spacer-top\" variant=\"warning\">\n          {translate('code_viewer.no_source_code_displayed_due_to_security')}\n        </Alert>\n      );\n    }\n\n    const { components, duplications, duplicationsByLine, linePopup } = this.state;\n    const issuesByComponent = issuesByComponentAndLine(this.props.issues);\n    const locationsByComponent = groupLocationsByComponent(this.props.locations, components);\n\n    return (\n      <div>\n        {locationsByComponent.map((snippetGroup, i) => {\n          let componentProps = {};\n          if (linePopup && snippetGroup.component.key === linePopup.component) {\n            componentProps = {\n              duplications,\n              duplicationsByLine,\n              linePopup: { index: linePopup.index, line: linePopup.line, name: linePopup.name }\n            };\n          }\n          return (\n            <SourceViewerContext.Provider\n              key={`${this.props.issue.key}-${this.props.selectedFlowIndex || 0}-${i}`}\n              value={{ branchLike: this.props.branchLike, file: snippetGroup.component }}>\n              <ComponentSourceSnippetViewer\n                branchLike={this.props.branchLike}\n                highlightedLocationMessage={this.props.highlightedLocationMessage}\n                issue={this.props.issue}\n                issuePopup={this.state.issuePopup}\n                issuesByLine={issuesByComponent[snippetGroup.component.key] || {}}\n                last={i === locationsByComponent.length - 1}\n                loadDuplications={this.fetchDuplications}\n                locations={snippetGroup.locations || []}\n                onIssueChange={this.props.onIssueChange}\n                onIssuePopupToggle={this.handleIssuePopupToggle}\n                onLinePopupToggle={this.handleLinePopupToggle}\n                onLocationSelect={this.props.onLocationSelect}\n                renderDuplicationPopup={this.renderDuplicationPopup}\n                scroll={this.props.scroll}\n                snippetGroup={snippetGroup}\n                {...componentProps}\n              />\n            </SourceViewerContext.Provider>\n          );\n        })}\n      </div>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nconst LINES_ABOVE = 5;\nconst LINES_BELOW = 5;\nexport const MERGE_DISTANCE = 11; // Merge if snippets are eleven lines away (separated by 10 lines) or fewer\nexport const LINES_BELOW_ISSUE = 9;\nexport const EXPAND_BY_LINES = 50;\n\nfunction unknownComponent(key: string): T.SnippetsByComponent {\n  return {\n    component: {\n      key,\n      measures: {},\n      path: '',\n      project: '',\n      projectName: '',\n      q: 'FIL',\n      uuid: ''\n    },\n    sources: []\n  };\n}\n\nfunction collision([startA, endA]: number[], [startB, endB]: number[]) {\n  return !(startA > endB + MERGE_DISTANCE || endA < startB - MERGE_DISTANCE);\n}\n\nfunction getPrimaryLocation(issue: T.Issue): T.FlowLocation {\n  return {\n    component: issue.component,\n    textRange: issue.textRange || {\n      endLine: 0,\n      endOffset: 0,\n      startLine: 0,\n      startOffset: 0\n    }\n  };\n}\n\nfunction addLinesBellow(params: { issue: T.Issue; locationEnd: number }) {\n  const { issue, locationEnd } = params;\n  const issueEndLine = (issue.textRange && issue.textRange.endLine) || 0;\n\n  if (!issueEndLine || issueEndLine === locationEnd) {\n    return locationEnd + LINES_BELOW_ISSUE;\n  }\n\n  return locationEnd + LINES_BELOW;\n}\n\nexport function createSnippets(params: {\n  locations: T.FlowLocation[];\n  issue: T.Issue;\n  addIssueLocation: boolean;\n}): T.Snippet[] {\n  const { locations, issue, addIssueLocation } = params;\n  // For each location's range (2 above and 2 below), and then compare with other ranges\n  // to merge snippets that collide.\n  return (addIssueLocation ? [getPrimaryLocation(issue), ...locations] : locations).reduce(\n    (snippets: T.Snippet[], loc, index) => {\n      const startIndex = Math.max(1, loc.textRange.startLine - LINES_ABOVE);\n      const endIndex = addLinesBellow({ issue, locationEnd: loc.textRange.endLine });\n\n      let firstCollision: { start: number; end: number } | undefined;\n\n      // Remove ranges that collide into the first collision\n      snippets = snippets.filter(snippet => {\n        if (collision([snippet.start, snippet.end], [startIndex, endIndex])) {\n          let keep = false;\n          // Check if we've already collided\n          if (!firstCollision) {\n            firstCollision = snippet;\n            keep = true;\n          }\n          // Merge with first collision:\n          firstCollision.start = Math.min(startIndex, snippet.start, firstCollision.start);\n          firstCollision.end = Math.max(endIndex, snippet.end, firstCollision.end);\n\n          // remove the range if it was not the first collision\n          return keep;\n        }\n        return true;\n      });\n\n      if (firstCollision === undefined) {\n        snippets.push({\n          start: startIndex,\n          end: endIndex,\n          index\n        });\n      }\n\n      return snippets;\n    },\n    []\n  );\n}\n\nexport function linesForSnippets(snippets: T.Snippet[], componentLines: T.LineMap) {\n  return snippets\n    .map(snippet => {\n      const lines = [];\n      for (let i = snippet.start; i <= snippet.end; i++) {\n        if (componentLines[i]) {\n          lines.push(componentLines[i]);\n        }\n      }\n      return lines;\n    })\n    .filter(snippet => snippet.length > 0);\n}\n\nexport function groupLocationsByComponent(\n  locations: T.FlowLocation[],\n  components: { [key: string]: T.SnippetsByComponent }\n) {\n  let currentComponent = '';\n  let currentGroup: T.SnippetGroup;\n  const groups: T.SnippetGroup[] = [];\n\n  locations.forEach((loc, index) => {\n    if (loc.component !== currentComponent) {\n      currentGroup = {\n        ...(components[loc.component] || unknownComponent(loc.component)),\n        locations: []\n      };\n      groups.push(currentGroup);\n      currentComponent = loc.component;\n    }\n    loc.index = index;\n    currentGroup.locations.push(loc);\n  });\n\n  return groups;\n}\n\nexport function expandSnippet({\n  direction,\n  snippetIndex,\n  snippets\n}: {\n  direction: T.ExpandDirection;\n  snippetIndex: number;\n  snippets: T.Snippet[];\n}) {\n  const snippetToExpand = snippets.find(s => s.index === snippetIndex);\n  if (!snippetToExpand) {\n    throw new Error(`Snippet ${snippetIndex} not found`);\n  }\n\n  snippetToExpand.start = Math.max(\n    0,\n    snippetToExpand.start - (direction === 'up' ? EXPAND_BY_LINES : 0)\n  );\n  snippetToExpand.end += direction === 'down' ? EXPAND_BY_LINES : 0;\n\n  return snippets.map(snippet => {\n    if (snippet.index === snippetIndex) {\n      return snippetToExpand;\n    }\n    if (collision([snippet.start, snippet.end], [snippetToExpand.start, snippetToExpand.end])) {\n      // Merge with expanded snippet\n      snippetToExpand.start = Math.min(snippet.start, snippetToExpand.start);\n      snippetToExpand.end = Math.max(snippet.end, snippetToExpand.end);\n      snippet.toDelete = true;\n    }\n    return snippet;\n  });\n}\n\nexport function inSnippet(line: number, snippet: T.SourceLine[]) {\n  return line >= snippet[0].line && line <= snippet[snippet.length - 1].line;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport classNames from 'classnames';\nimport * as React from 'react';\nimport ExpandSnippetIcon from 'sonar-ui-common/components/icons/ExpandSnippetIcon';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { scrollHorizontally } from 'sonar-ui-common/helpers/scrolling';\nimport Line from '../../../components/SourceViewer/components/Line';\nimport { symbolsByLine } from '../../../components/SourceViewer/helpers/indexing';\nimport { getSecondaryIssueLocationsForLine } from '../../../components/SourceViewer/helpers/issueLocations';\nimport {\n  optimizeHighlightedSymbols,\n  optimizeLocationMessage,\n  optimizeSelectedIssue\n} from '../../../components/SourceViewer/helpers/lines';\nimport { BranchLike } from '../../../types/branch-like';\nimport './SnippetViewer.css';\nimport { inSnippet, LINES_BELOW_ISSUE } from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  component: T.SourceViewerFile;\n  displaySCM?: boolean;\n  duplications?: T.Duplication[];\n  duplicationsByLine?: { [line: number]: number[] };\n  expandBlock: (snippetIndex: number, direction: T.ExpandDirection) => Promise<void>;\n  handleCloseIssues: (line: T.SourceLine) => void;\n  handleLinePopupToggle: (line: T.SourceLine) => void;\n  handleOpenIssues: (line: T.SourceLine) => void;\n  handleSymbolClick: (symbols: string[]) => void;\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined;\n  highlightedSymbols: string[];\n  index: number;\n  issue: Pick<T.Issue, 'key' | 'textRange' | 'line'>;\n  issuePopup?: { issue: string; name: string };\n  issuesByLine: T.IssuesByLine;\n  last: boolean;\n  linePopup?: T.LinePopup;\n  loadDuplications: (line: T.SourceLine) => void;\n  locations: T.FlowLocation[];\n  locationsByLine: { [line: number]: T.LinearIssueLocation[] };\n  onIssueChange: (issue: T.Issue) => void;\n  onIssuePopupToggle: (issue: string, popupName: string, open?: boolean) => void;\n  onLocationSelect: (index: number) => void;\n  openIssuesByLine: T.Dict<boolean>;\n  renderDuplicationPopup: (index: number, line: number) => React.ReactNode;\n  scroll?: (element: HTMLElement, offset?: number) => void;\n  snippet: T.SourceLine[];\n}\n\nconst SCROLL_LEFT_OFFSET = 32;\n\nexport default class SnippetViewer extends React.PureComponent<Props> {\n  snippetNodeRef: React.RefObject<HTMLDivElement>;\n\n  constructor(props: Props) {\n    super(props);\n    this.snippetNodeRef = React.createRef();\n  }\n\n  doScroll = (element: HTMLElement) => {\n    if (this.props.scroll) {\n      this.props.scroll(element);\n    }\n    const parent = this.snippetNodeRef.current as Element;\n\n    if (parent) {\n      scrollHorizontally(element, {\n        leftOffset: SCROLL_LEFT_OFFSET,\n        rightOffset: parent.getBoundingClientRect().width - SCROLL_LEFT_OFFSET,\n        parent\n      });\n    }\n  };\n\n  scrollToLastExpandedRow = () => {\n    if (this.props.scroll) {\n      const snippetNode = this.snippetNodeRef.current as Element;\n      if (!snippetNode) {\n        return;\n      }\n      const rows = snippetNode.querySelectorAll('tr');\n      const lastRow = rows[rows.length - 1];\n      this.props.scroll(lastRow, 100);\n    }\n  };\n\n  expandBlock = (direction: T.ExpandDirection) => () =>\n    this.props.expandBlock(this.props.index, direction).then(() => {\n      if (direction === 'down') {\n        this.scrollToLastExpandedRow();\n      }\n    });\n\n  renderLine({\n    displayDuplications,\n    displaySCM,\n    index,\n    issuesForLine,\n    issueLocations,\n    line,\n    snippet,\n    symbols,\n    verticalBuffer\n  }: {\n    displayDuplications: boolean;\n    displaySCM?: boolean;\n    index: number;\n    issuesForLine: T.Issue[];\n    issueLocations: T.LinearIssueLocation[];\n    line: T.SourceLine;\n    snippet: T.SourceLine[];\n    symbols: string[];\n    verticalBuffer: number;\n  }) {\n    const secondaryIssueLocations = getSecondaryIssueLocationsForLine(line, this.props.locations);\n\n    const { duplications, duplicationsByLine } = this.props;\n    const duplicationsCount = duplications ? duplications.length : 0;\n    const lineDuplications =\n      (duplicationsCount && duplicationsByLine && duplicationsByLine[line.line]) || [];\n\n    const isSinkLine = issuesForLine.some(i => i.key === this.props.issue.key);\n\n    return (\n      <Line\n        branchLike={this.props.branchLike}\n        displayAllIssues={false}\n        displayCoverage={true}\n        displayDuplications={displayDuplications}\n        displayIssues={!isSinkLine || issuesForLine.length > 1}\n        displayLocationMarkers={true}\n        displaySCM={displaySCM}\n        duplications={lineDuplications}\n        duplicationsCount={duplicationsCount}\n        highlighted={false}\n        highlightedLocationMessage={optimizeLocationMessage(\n          this.props.highlightedLocationMessage,\n          secondaryIssueLocations\n        )}\n        highlightedSymbols={optimizeHighlightedSymbols(symbols, this.props.highlightedSymbols)}\n        issueLocations={issueLocations}\n        issuePopup={this.props.issuePopup}\n        issues={issuesForLine}\n        key={line.line}\n        last={false}\n        line={line}\n        linePopup={this.props.linePopup}\n        loadDuplications={this.props.loadDuplications}\n        onIssueChange={this.props.onIssueChange}\n        onIssuePopupToggle={this.props.onIssuePopupToggle}\n        onIssueSelect={() => {}}\n        onIssueUnselect={() => {}}\n        onIssuesClose={this.props.handleCloseIssues}\n        onIssuesOpen={this.props.handleOpenIssues}\n        onLinePopupToggle={this.props.handleLinePopupToggle}\n        onLocationSelect={this.props.onLocationSelect}\n        onSymbolClick={this.props.handleSymbolClick}\n        openIssues={this.props.openIssuesByLine[line.line]}\n        previousLine={index > 0 ? snippet[index - 1] : undefined}\n        renderDuplicationPopup={this.props.renderDuplicationPopup}\n        scroll={this.doScroll}\n        secondaryIssueLocations={secondaryIssueLocations}\n        selectedIssue={optimizeSelectedIssue(this.props.issue.key, issuesForLine)}\n        verticalBuffer={verticalBuffer}\n      />\n    );\n  }\n\n  render() {\n    const {\n      component,\n      displaySCM,\n      issue,\n      issuesByLine = {},\n      last,\n      locationsByLine,\n      openIssuesByLine,\n      snippet\n    } = this.props;\n    const lastLine =\n      component.measures && component.measures.lines && parseInt(component.measures.lines, 10);\n\n    const symbols = symbolsByLine(snippet);\n\n    const bottomLine = snippet[snippet.length - 1].line;\n    const issueLine = issue.textRange ? issue.textRange.endLine : issue.line;\n    const lowestVisibleIssue = Math.max(\n      ...Object.keys(issuesByLine)\n        .map(k => parseInt(k, 10))\n        .filter(l => inSnippet(l, snippet) && (l === issueLine || openIssuesByLine[l]))\n    );\n    const verticalBuffer = last\n      ? Math.max(0, LINES_BELOW_ISSUE - (bottomLine - lowestVisibleIssue))\n      : 0;\n\n    const displayDuplications = snippet.some(s => !!s.duplicated);\n\n    return (\n      <div className=\"source-viewer-code snippet\" ref={this.snippetNodeRef}>\n        <div>\n          {snippet[0].line > 1 && (\n            <div className=\"expand-block expand-block-above\">\n              <button\n                aria-label={translate('source_viewer.expand_above')}\n                onClick={this.expandBlock('up')}\n                type=\"button\">\n                <ExpandSnippetIcon />\n              </button>\n            </div>\n          )}\n          <table\n            className={classNames('source-table', {\n              'expand-up': snippet[0].line > 1,\n              'expand-down': !lastLine || snippet[snippet.length - 1].line < lastLine\n            })}>\n            <tbody>\n              {snippet.map((line, index) =>\n                this.renderLine({\n                  displayDuplications,\n                  displaySCM,\n                  index,\n                  issuesForLine: issuesByLine[line.line] || [],\n                  issueLocations: locationsByLine[line.line] || [],\n                  line,\n                  snippet,\n                  symbols: symbols[line.line],\n                  verticalBuffer: index === snippet.length - 1 ? verticalBuffer : 0\n                })\n              )}\n            </tbody>\n          </table>\n          {(!lastLine || snippet[snippet.length - 1].line < lastLine) && (\n            <div className=\"expand-block expand-block-below\">\n              <button\n                aria-label={translate('source_viewer.expand_below')}\n                onClick={this.expandBlock('down')}\n                type=\"button\">\n                <ExpandSnippetIcon />\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n}\n","\nvar content = require(\"!!../../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../../node_modules/postcss-loader/src/index.js??postcss!./SnippetViewer.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../../node_modules/postcss-loader/src/index.js??postcss!./SnippetViewer.css\", function() {\n\t\tvar newContent = require(\"!!../../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../../node_modules/postcss-loader/src/index.js??postcss!./SnippetViewer.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../../../../node_modules/css-loader/dist/runtime/api.js\")(false);\n// Module\nexports.push([module.id, \".snippet{margin:8px;border:1px solid #cdcdcd;overflow-x:auto;overflow-y:hidden;transition:max-height .2s}.snippet>div{display:table;width:100%;position:relative;transition:margin-top .2s}.snippet table{width:100%}.expand-block{position:absolute;z-index:2;width:100%}.expand-block>button{background:transparent;box-sizing:border-box;color:#777;height:20px;width:100%;padding:2px;border:0;text-align:left;cursor:pointer}.expand-block>button:active,.expand-block>button:focus,.expand-block>button:hover{color:#236a97;outline:none}.expand-block-above{background:url(\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAAXNSR0IArs4c6QAAADdJREFUCB1dzMEKADAIAlBd1v9/bcc2YgRjHh8qq2qTxCQzsX4wM6y30RARF3sy0Es1SIK7Y64OpCES1W69JS4AAAAASUVORK5CYII=\\\");top:0}.expand-block-below{background:url(\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4wQQBjQEQVd5jwAAADhJREFUCNddyTEKADEMA8GVA/7/Z+PGwUp1cGTaYe/tv5lxrLWoKj6SiMzkjZDEG7JtANt0N+ccLrB/KZxXTt7fAAAAAElFTkSuQmCC\\\");bottom:0}.source-table.expand-up{margin-top:20px}.source-table.expand-down{margin-bottom:20px}\", \"\"]);\n\n"],"sourceRoot":""}