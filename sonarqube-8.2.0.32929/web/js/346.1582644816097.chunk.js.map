{"version":3,"sources":["webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/utils.ts","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.tsx","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.css?6bd4","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.css","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/ComponentSourceSnippetViewer.tsx","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/CrossComponentSourceViewerWrapper.tsx"],"names":["LINES_ABOVE","LINES_BELOW","MERGE_DISTANCE","LINES_BELOW_ISSUE","EXPAND_BY_LINES","collision","_a","_b","startA","endA","startB","getPrimaryLocation","issue","component","textRange","endLine","endOffset","startLine","startOffset","createSnippets","params","locations","addIssueLocation","__spreadArrays","reduce","snippets","loc","index","firstCollision","startIndex","Math","max","endIndex","locationEnd","issueEndLine","addLinesBellow","filter","snippet","start","end","keep","min","undefined","push","linesForSnippets","componentLines","map","lines","i","length","groupLocationsByComponent","components","currentGroup","currentComponent","groups","forEach","__assign","key","measures","path","project","projectName","q","uuid","sources","expandSnippet","direction","snippetIndex","snippetToExpand","find","s","Error","toDelete","inSnippet","line","SCROLL_LEFT_OFFSET","SnippetViewer","_super","props","_this","call","this","doScroll","element","scroll","parent","snippetNodeRef","current","Object","sonar_ui_common_helpers_scrolling__WEBPACK_IMPORTED_MODULE_4__","leftOffset","rightOffset","getBoundingClientRect","width","scrollToLastExpandedRow","snippetNode","rows","querySelectorAll","lastRow","expandBlock","then","react__WEBPACK_IMPORTED_MODULE_1__","__extends","prototype","renderLine","displayDuplications","displaySCM","issuesForLine","issueLocations","symbols","verticalBuffer","secondaryIssueLocations","_components_SourceViewer_helpers_issueLocations__WEBPACK_IMPORTED_MODULE_7__","duplications","duplicationsByLine","duplicationsCount","lineDuplications","isSinkLine","some","_components_SourceViewer_components_Line__WEBPACK_IMPORTED_MODULE_5__","branchLike","displayAllIssues","displayCoverage","displayIssues","displayLocationMarkers","highlighted","highlightedLocationMessage","_components_SourceViewer_helpers_lines__WEBPACK_IMPORTED_MODULE_8__","highlightedSymbols","issuePopup","issues","last","linePopup","loadDuplications","onIssueChange","onIssuePopupToggle","onIssueSelect","onIssueUnselect","onIssuesClose","handleCloseIssues","onIssuesOpen","handleOpenIssues","onLinePopupToggle","handleLinePopupToggle","onLocationSelect","onSymbolClick","handleSymbolClick","openIssues","openIssuesByLine","previousLine","renderDuplicationPopup","selectedIssue","render","issuesByLine","locationsByLine","lastLine","parseInt","_components_SourceViewer_helpers_indexing__WEBPACK_IMPORTED_MODULE_6__","bottomLine","issueLine","lowestVisibleIssue","apply","keys","k","l","_utils__WEBPACK_IMPORTED_MODULE_10__","duplicated","className","ref","aria-label","sonar_ui_common_helpers_l10n__WEBPACK_IMPORTED_MODULE_3__","onClick","type","sonar_ui_common_components_icons_ExpandSnippetIcon__WEBPACK_IMPORTED_MODULE_2___default","a","classnames__WEBPACK_IMPORTED_MODULE_0___default","expand-up","expand-down","content","__webpack_require__","module","options","hmr","transform","insertInto","locals","exports","ComponentSourceSnippetViewer","arguments","mounted","rootNodeRef","index_js_exposed","state","additionalLines","loading","snippetGroup","Promise","reject","extension","utils","range","from","to","api_components","branch_like","lineMap","coverageStatus","getCoverageStatus","newLinesMapped","animateBlockExpansion","expandComponent","setState","componentDidMount","createSnippetsFromProps","componentWillUnmount","secondaryLocations","getNodes","root","querySelector","wrapper","table","firstChild","cleanDom","nodes","style","marginTop","maxHeight","setMaxHeight","value","up","height","startHeight","transition","setTimeout","newSnippets_1","deletedSnippets_1","resolve","renderSnippet","indexing","fullyShown","snippetLines","classnames","source-duplications-expanded","SourceViewerHeaderSlim","expandable","onExpand","sourceViewerFile","id","CrossComponentSourceViewerWrapper_CrossComponentSourceViewerWrapper","CrossComponentSourceViewerWrapper","notAccessible","fetchDuplications","CrossComponentSourceViewerWrapper_assign","r","duplicatedFiles","files","name","handleIssuePopupToggle","popupName","open","samePopup","handleCloseLinePopup","blocks","helpers_duplications","context","Consumer","openComponent","DuplicationPopup","inRemovedComponent","onClose","CrossComponentSourceViewerWrapper_extends","fetchIssueFlowSnippets","componentWillReceiveProps","newProps","issueKey","onLoaded","response","status","throwGlobalError","DeferredSpinner_default","Alert","variant","l10n","issuesByComponent","locationsByComponent","componentProps","SourceViewerContext","Provider","selectedFlowIndex","file","crossComponentSourceViewer_ComponentSourceSnippetViewer"],"mappings":"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","file":"js/346.1582644816097.chunk.js","sourcesContent":["/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nconst LINES_ABOVE = 5;\nconst LINES_BELOW = 5;\nexport const MERGE_DISTANCE = 11; // Merge if snippets are eleven lines away (separated by 10 lines) or fewer\nexport const LINES_BELOW_ISSUE = 9;\nexport const EXPAND_BY_LINES = 50;\n\nfunction unknownComponent(key: string): T.SnippetsByComponent {\n  return {\n    component: {\n      key,\n      measures: {},\n      path: '',\n      project: '',\n      projectName: '',\n      q: 'FIL',\n      uuid: ''\n    },\n    sources: []\n  };\n}\n\nfunction collision([startA, endA]: number[], [startB, endB]: number[]) {\n  return !(startA > endB + MERGE_DISTANCE || endA < startB - MERGE_DISTANCE);\n}\n\nfunction getPrimaryLocation(issue: T.Issue): T.FlowLocation {\n  return {\n    component: issue.component,\n    textRange: issue.textRange || {\n      endLine: 0,\n      endOffset: 0,\n      startLine: 0,\n      startOffset: 0\n    }\n  };\n}\n\nfunction addLinesBellow(params: { issue: T.Issue; locationEnd: number }) {\n  const { issue, locationEnd } = params;\n  const issueEndLine = (issue.textRange && issue.textRange.endLine) || 0;\n\n  if (!issueEndLine || issueEndLine === locationEnd) {\n    return locationEnd + LINES_BELOW_ISSUE;\n  }\n\n  return locationEnd + LINES_BELOW;\n}\n\nexport function createSnippets(params: {\n  locations: T.FlowLocation[];\n  issue: T.Issue;\n  addIssueLocation: boolean;\n}): T.Snippet[] {\n  const { locations, issue, addIssueLocation } = params;\n  // For each location's range (2 above and 2 below), and then compare with other ranges\n  // to merge snippets that collide.\n  return (addIssueLocation ? [getPrimaryLocation(issue), ...locations] : locations).reduce(\n    (snippets: T.Snippet[], loc, index) => {\n      const startIndex = Math.max(1, loc.textRange.startLine - LINES_ABOVE);\n      const endIndex = addLinesBellow({ issue, locationEnd: loc.textRange.endLine });\n\n      let firstCollision: { start: number; end: number } | undefined;\n\n      // Remove ranges that collide into the first collision\n      snippets = snippets.filter(snippet => {\n        if (collision([snippet.start, snippet.end], [startIndex, endIndex])) {\n          let keep = false;\n          // Check if we've already collided\n          if (!firstCollision) {\n            firstCollision = snippet;\n            keep = true;\n          }\n          // Merge with first collision:\n          firstCollision.start = Math.min(startIndex, snippet.start, firstCollision.start);\n          firstCollision.end = Math.max(endIndex, snippet.end, firstCollision.end);\n\n          // remove the range if it was not the first collision\n          return keep;\n        }\n        return true;\n      });\n\n      if (firstCollision === undefined) {\n        snippets.push({\n          start: startIndex,\n          end: endIndex,\n          index\n        });\n      }\n\n      return snippets;\n    },\n    []\n  );\n}\n\nexport function linesForSnippets(snippets: T.Snippet[], componentLines: T.LineMap) {\n  return snippets\n    .map(snippet => {\n      const lines = [];\n      for (let i = snippet.start; i <= snippet.end; i++) {\n        if (componentLines[i]) {\n          lines.push(componentLines[i]);\n        }\n      }\n      return lines;\n    })\n    .filter(snippet => snippet.length > 0);\n}\n\nexport function groupLocationsByComponent(\n  locations: T.FlowLocation[],\n  components: { [key: string]: T.SnippetsByComponent }\n) {\n  let currentComponent = '';\n  let currentGroup: T.SnippetGroup;\n  const groups: T.SnippetGroup[] = [];\n\n  locations.forEach((loc, index) => {\n    if (loc.component !== currentComponent) {\n      currentGroup = {\n        ...(components[loc.component] || unknownComponent(loc.component)),\n        locations: []\n      };\n      groups.push(currentGroup);\n      currentComponent = loc.component;\n    }\n    loc.index = index;\n    currentGroup.locations.push(loc);\n  });\n\n  return groups;\n}\n\nexport function expandSnippet({\n  direction,\n  snippetIndex,\n  snippets\n}: {\n  direction: T.ExpandDirection;\n  snippetIndex: number;\n  snippets: T.Snippet[];\n}) {\n  const snippetToExpand = snippets.find(s => s.index === snippetIndex);\n  if (!snippetToExpand) {\n    throw new Error(`Snippet ${snippetIndex} not found`);\n  }\n\n  snippetToExpand.start = Math.max(\n    0,\n    snippetToExpand.start - (direction === 'up' ? EXPAND_BY_LINES : 0)\n  );\n  snippetToExpand.end += direction === 'down' ? EXPAND_BY_LINES : 0;\n\n  return snippets.map(snippet => {\n    if (snippet.index === snippetIndex) {\n      return snippetToExpand;\n    }\n    if (collision([snippet.start, snippet.end], [snippetToExpand.start, snippetToExpand.end])) {\n      // Merge with expanded snippet\n      snippetToExpand.start = Math.min(snippet.start, snippetToExpand.start);\n      snippetToExpand.end = Math.max(snippet.end, snippetToExpand.end);\n      snippet.toDelete = true;\n    }\n    return snippet;\n  });\n}\n\nexport function inSnippet(line: number, snippet: T.SourceLine[]) {\n  return line >= snippet[0].line && line <= snippet[snippet.length - 1].line;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport classNames from 'classnames';\nimport * as React from 'react';\nimport ExpandSnippetIcon from 'sonar-ui-common/components/icons/ExpandSnippetIcon';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { scrollHorizontally } from 'sonar-ui-common/helpers/scrolling';\nimport Line from '../../../components/SourceViewer/components/Line';\nimport { symbolsByLine } from '../../../components/SourceViewer/helpers/indexing';\nimport { getSecondaryIssueLocationsForLine } from '../../../components/SourceViewer/helpers/issueLocations';\nimport {\n  optimizeHighlightedSymbols,\n  optimizeLocationMessage,\n  optimizeSelectedIssue\n} from '../../../components/SourceViewer/helpers/lines';\nimport { BranchLike } from '../../../types/branch-like';\nimport './SnippetViewer.css';\nimport { inSnippet, LINES_BELOW_ISSUE } from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  component: T.SourceViewerFile;\n  displaySCM?: boolean;\n  duplications?: T.Duplication[];\n  duplicationsByLine?: { [line: number]: number[] };\n  expandBlock: (snippetIndex: number, direction: T.ExpandDirection) => Promise<void>;\n  handleCloseIssues: (line: T.SourceLine) => void;\n  handleLinePopupToggle: (line: T.SourceLine) => void;\n  handleOpenIssues: (line: T.SourceLine) => void;\n  handleSymbolClick: (symbols: string[]) => void;\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined;\n  highlightedSymbols: string[];\n  index: number;\n  issue: Pick<T.Issue, 'key' | 'textRange' | 'line'>;\n  issuePopup?: { issue: string; name: string };\n  issuesByLine: T.IssuesByLine;\n  last: boolean;\n  linePopup?: T.LinePopup;\n  loadDuplications: (line: T.SourceLine) => void;\n  locations: T.FlowLocation[];\n  locationsByLine: { [line: number]: T.LinearIssueLocation[] };\n  onIssueChange: (issue: T.Issue) => void;\n  onIssuePopupToggle: (issue: string, popupName: string, open?: boolean) => void;\n  onLocationSelect: (index: number) => void;\n  openIssuesByLine: T.Dict<boolean>;\n  renderDuplicationPopup: (index: number, line: number) => React.ReactNode;\n  scroll?: (element: HTMLElement, offset?: number) => void;\n  snippet: T.SourceLine[];\n}\n\nconst SCROLL_LEFT_OFFSET = 32;\n\nexport default class SnippetViewer extends React.PureComponent<Props> {\n  snippetNodeRef: React.RefObject<HTMLDivElement>;\n\n  constructor(props: Props) {\n    super(props);\n    this.snippetNodeRef = React.createRef();\n  }\n\n  doScroll = (element: HTMLElement) => {\n    if (this.props.scroll) {\n      this.props.scroll(element);\n    }\n    const parent = this.snippetNodeRef.current as Element;\n\n    if (parent) {\n      scrollHorizontally(element, {\n        leftOffset: SCROLL_LEFT_OFFSET,\n        rightOffset: parent.getBoundingClientRect().width - SCROLL_LEFT_OFFSET,\n        parent\n      });\n    }\n  };\n\n  scrollToLastExpandedRow = () => {\n    if (this.props.scroll) {\n      const snippetNode = this.snippetNodeRef.current as Element;\n      if (!snippetNode) {\n        return;\n      }\n      const rows = snippetNode.querySelectorAll('tr');\n      const lastRow = rows[rows.length - 1];\n      this.props.scroll(lastRow, 100);\n    }\n  };\n\n  expandBlock = (direction: T.ExpandDirection) => () =>\n    this.props.expandBlock(this.props.index, direction).then(() => {\n      if (direction === 'down') {\n        this.scrollToLastExpandedRow();\n      }\n    });\n\n  renderLine({\n    displayDuplications,\n    displaySCM,\n    index,\n    issuesForLine,\n    issueLocations,\n    line,\n    snippet,\n    symbols,\n    verticalBuffer\n  }: {\n    displayDuplications: boolean;\n    displaySCM?: boolean;\n    index: number;\n    issuesForLine: T.Issue[];\n    issueLocations: T.LinearIssueLocation[];\n    line: T.SourceLine;\n    snippet: T.SourceLine[];\n    symbols: string[];\n    verticalBuffer: number;\n  }) {\n    const secondaryIssueLocations = getSecondaryIssueLocationsForLine(line, this.props.locations);\n\n    const { duplications, duplicationsByLine } = this.props;\n    const duplicationsCount = duplications ? duplications.length : 0;\n    const lineDuplications =\n      (duplicationsCount && duplicationsByLine && duplicationsByLine[line.line]) || [];\n\n    const isSinkLine = issuesForLine.some(i => i.key === this.props.issue.key);\n\n    return (\n      <Line\n        branchLike={this.props.branchLike}\n        displayAllIssues={false}\n        displayCoverage={true}\n        displayDuplications={displayDuplications}\n        displayIssues={!isSinkLine || issuesForLine.length > 1}\n        displayLocationMarkers={true}\n        displaySCM={displaySCM}\n        duplications={lineDuplications}\n        duplicationsCount={duplicationsCount}\n        highlighted={false}\n        highlightedLocationMessage={optimizeLocationMessage(\n          this.props.highlightedLocationMessage,\n          secondaryIssueLocations\n        )}\n        highlightedSymbols={optimizeHighlightedSymbols(symbols, this.props.highlightedSymbols)}\n        issueLocations={issueLocations}\n        issuePopup={this.props.issuePopup}\n        issues={issuesForLine}\n        key={line.line}\n        last={false}\n        line={line}\n        linePopup={this.props.linePopup}\n        loadDuplications={this.props.loadDuplications}\n        onIssueChange={this.props.onIssueChange}\n        onIssuePopupToggle={this.props.onIssuePopupToggle}\n        onIssueSelect={() => {}}\n        onIssueUnselect={() => {}}\n        onIssuesClose={this.props.handleCloseIssues}\n        onIssuesOpen={this.props.handleOpenIssues}\n        onLinePopupToggle={this.props.handleLinePopupToggle}\n        onLocationSelect={this.props.onLocationSelect}\n        onSymbolClick={this.props.handleSymbolClick}\n        openIssues={this.props.openIssuesByLine[line.line]}\n        previousLine={index > 0 ? snippet[index - 1] : undefined}\n        renderDuplicationPopup={this.props.renderDuplicationPopup}\n        scroll={this.doScroll}\n        secondaryIssueLocations={secondaryIssueLocations}\n        selectedIssue={optimizeSelectedIssue(this.props.issue.key, issuesForLine)}\n        verticalBuffer={verticalBuffer}\n      />\n    );\n  }\n\n  render() {\n    const {\n      component,\n      displaySCM,\n      issue,\n      issuesByLine = {},\n      last,\n      locationsByLine,\n      openIssuesByLine,\n      snippet\n    } = this.props;\n    const lastLine =\n      component.measures && component.measures.lines && parseInt(component.measures.lines, 10);\n\n    const symbols = symbolsByLine(snippet);\n\n    const bottomLine = snippet[snippet.length - 1].line;\n    const issueLine = issue.textRange ? issue.textRange.endLine : issue.line;\n    const lowestVisibleIssue = Math.max(\n      ...Object.keys(issuesByLine)\n        .map(k => parseInt(k, 10))\n        .filter(l => inSnippet(l, snippet) && (l === issueLine || openIssuesByLine[l]))\n    );\n    const verticalBuffer = last\n      ? Math.max(0, LINES_BELOW_ISSUE - (bottomLine - lowestVisibleIssue))\n      : 0;\n\n    const displayDuplications = snippet.some(s => !!s.duplicated);\n\n    return (\n      <div className=\"source-viewer-code snippet\" ref={this.snippetNodeRef}>\n        <div>\n          {snippet[0].line > 1 && (\n            <div className=\"expand-block expand-block-above\">\n              <button\n                aria-label={translate('source_viewer.expand_above')}\n                onClick={this.expandBlock('up')}\n                type=\"button\">\n                <ExpandSnippetIcon />\n              </button>\n            </div>\n          )}\n          <table\n            className={classNames('source-table', {\n              'expand-up': snippet[0].line > 1,\n              'expand-down': !lastLine || snippet[snippet.length - 1].line < lastLine\n            })}>\n            <tbody>\n              {snippet.map((line, index) =>\n                this.renderLine({\n                  displayDuplications,\n                  displaySCM,\n                  index,\n                  issuesForLine: issuesByLine[line.line] || [],\n                  issueLocations: locationsByLine[line.line] || [],\n                  line,\n                  snippet,\n                  symbols: symbols[line.line],\n                  verticalBuffer: index === snippet.length - 1 ? verticalBuffer : 0\n                })\n              )}\n            </tbody>\n          </table>\n          {(!lastLine || snippet[snippet.length - 1].line < lastLine) && (\n            <div className=\"expand-block expand-block-below\">\n              <button\n                aria-label={translate('source_viewer.expand_below')}\n                onClick={this.expandBlock('down')}\n                type=\"button\">\n                <ExpandSnippetIcon />\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n}\n","\nvar content = require(\"!!../../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../../node_modules/postcss-loader/src/index.js??postcss!./SnippetViewer.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../../node_modules/postcss-loader/src/index.js??postcss!./SnippetViewer.css\", function() {\n\t\tvar newContent = require(\"!!../../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../../node_modules/postcss-loader/src/index.js??postcss!./SnippetViewer.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../../../../node_modules/css-loader/dist/runtime/api.js\")(false);\n// Module\nexports.push([module.id, \".snippet{margin:8px;border:1px solid #cdcdcd;overflow-x:auto;overflow-y:hidden;transition:max-height .2s}.snippet>div{display:table;width:100%;position:relative;transition:margin-top .2s}.snippet table{width:100%}.expand-block{position:absolute;z-index:2;width:100%}.expand-block>button{background:transparent;box-sizing:border-box;color:#777;height:20px;width:100%;padding:2px;border:0;text-align:left;cursor:pointer}.expand-block>button:active,.expand-block>button:focus,.expand-block>button:hover{color:#236a97;outline:none}.expand-block-above{background:url(\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAAXNSR0IArs4c6QAAADdJREFUCB1dzMEKADAIAlBd1v9/bcc2YgRjHh8qq2qTxCQzsX4wM6y30RARF3sy0Es1SIK7Y64OpCES1W69JS4AAAAASUVORK5CYII=\\\");top:0}.expand-block-below{background:url(\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4wQQBjQEQVd5jwAAADhJREFUCNddyTEKADEMA8GVA/7/Z+PGwUp1cGTaYe/tv5lxrLWoKj6SiMzkjZDEG7JtANt0N+ccLrB/KZxXTt7fAAAAAElFTkSuQmCC\\\");bottom:0}.source-table.expand-up{margin-top:20px}.source-table.expand-down{margin-bottom:20px}\", \"\"]);\n\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport { getSources } from '../../../api/components';\nimport getCoverageStatus from '../../../components/SourceViewer/helpers/getCoverageStatus';\nimport { locationsByLine } from '../../../components/SourceViewer/helpers/indexing';\nimport SourceViewerHeaderSlim from '../../../components/SourceViewer/SourceViewerHeaderSlim';\nimport { getBranchLikeQuery } from '../../../helpers/branch-like';\nimport { BranchLike } from '../../../types/branch-like';\nimport SnippetViewer from './SnippetViewer';\nimport {\n  createSnippets,\n  expandSnippet,\n  EXPAND_BY_LINES,\n  linesForSnippets,\n  MERGE_DISTANCE\n} from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  duplications?: T.Duplication[];\n  duplicationsByLine?: { [line: number]: number[] };\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined;\n  issue: T.Issue;\n  issuePopup?: { issue: string; name: string };\n  issuesByLine: T.IssuesByLine;\n  last: boolean;\n  linePopup?: T.LinePopup;\n  loadDuplications: (component: string, line: T.SourceLine) => void;\n  locations: T.FlowLocation[];\n  onIssueChange: (issue: T.Issue) => void;\n  onIssuePopupToggle: (issue: string, popupName: string, open?: boolean) => void;\n  onLinePopupToggle: (linePopup: T.LinePopup & { component: string }) => void;\n  onLocationSelect: (index: number) => void;\n  renderDuplicationPopup: (\n    component: T.SourceViewerFile,\n    index: number,\n    line: number\n  ) => React.ReactNode;\n  scroll?: (element: HTMLElement, offset: number) => void;\n  snippetGroup: T.SnippetGroup;\n}\n\ninterface State {\n  additionalLines: { [line: number]: T.SourceLine };\n  highlightedSymbols: string[];\n  loading: boolean;\n  openIssuesByLine: T.Dict<boolean>;\n  snippets: T.Snippet[];\n}\n\nexport default class ComponentSourceSnippetViewer extends React.PureComponent<Props, State> {\n  mounted = false;\n  rootNodeRef = React.createRef<HTMLDivElement>();\n  state: State = {\n    additionalLines: {},\n    highlightedSymbols: [],\n    loading: false,\n    openIssuesByLine: {},\n    snippets: []\n  };\n\n  componentDidMount() {\n    this.mounted = true;\n    this.createSnippetsFromProps();\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  createSnippetsFromProps() {\n    const snippets = createSnippets({\n      locations: this.props.snippetGroup.locations,\n      issue: this.props.issue,\n      addIssueLocation: this.props.issue.secondaryLocations.length > 0\n    });\n\n    this.setState({ snippets });\n  }\n\n  getNodes(index: number): { wrapper: HTMLElement; table: HTMLElement } | undefined {\n    const root = this.rootNodeRef.current;\n    if (!root) {\n      return undefined;\n    }\n    const element = root.querySelector(`#snippet-wrapper-${index}`);\n    if (!element) {\n      return undefined;\n    }\n    const wrapper = element.querySelector<HTMLElement>('.snippet');\n    if (!wrapper) {\n      return undefined;\n    }\n    const table = wrapper.firstChild as HTMLElement;\n    if (!table) {\n      return undefined;\n    }\n\n    return { wrapper, table };\n  }\n\n  /*\n   * Clean after animation\n   */\n  cleanDom(index: number) {\n    const nodes = this.getNodes(index);\n\n    if (!nodes) {\n      return;\n    }\n\n    const { wrapper, table } = nodes;\n\n    table.style.marginTop = '';\n    wrapper.style.maxHeight = '';\n  }\n\n  setMaxHeight(index: number, value?: number, up = false) {\n    const nodes = this.getNodes(index);\n\n    if (!nodes) {\n      return;\n    }\n\n    const { wrapper, table } = nodes;\n\n    const maxHeight = value !== undefined ? value : table.getBoundingClientRect().height;\n\n    if (up) {\n      const startHeight = wrapper.getBoundingClientRect().height;\n      table.style.transition = 'none';\n      table.style.marginTop = `${startHeight - maxHeight}px`;\n\n      // animate!\n      setTimeout(() => {\n        table.style.transition = '';\n        table.style.marginTop = '0px';\n        wrapper.style.maxHeight = `${maxHeight + 20}px`;\n      }, 0);\n    } else {\n      wrapper.style.maxHeight = `${maxHeight + 20}px`;\n    }\n  }\n\n  expandBlock = (snippetIndex: number, direction: T.ExpandDirection): Promise<void> => {\n    const { branchLike, snippetGroup } = this.props;\n    const { key } = snippetGroup.component;\n    const { snippets } = this.state;\n    const snippet = snippets.find(s => s.index === snippetIndex);\n    if (!snippet) {\n      return Promise.reject();\n    }\n    // Extend by EXPAND_BY_LINES and add buffer for merging snippets\n    const extension = EXPAND_BY_LINES + MERGE_DISTANCE - 1;\n    const range =\n      direction === 'up'\n        ? {\n            from: Math.max(1, snippet.start - extension),\n            to: snippet.start - 1\n          }\n        : {\n            from: snippet.end + 1,\n            to: snippet.end + extension\n          };\n    return getSources({\n      key,\n      ...range,\n      ...getBranchLikeQuery(branchLike)\n    })\n      .then(lines =>\n        lines.reduce((lineMap: T.Dict<T.SourceLine>, line) => {\n          line.coverageStatus = getCoverageStatus(line);\n          lineMap[line.line] = line;\n          return lineMap;\n        }, {})\n      )\n      .then(newLinesMapped => this.animateBlockExpansion(snippetIndex, direction, newLinesMapped));\n  };\n\n  animateBlockExpansion(\n    snippetIndex: number,\n    direction: T.ExpandDirection,\n    newLinesMapped: T.Dict<T.SourceLine>\n  ): Promise<void> {\n    if (this.mounted) {\n      const { snippets } = this.state;\n\n      const newSnippets = expandSnippet({\n        direction,\n        snippetIndex,\n        snippets\n      });\n\n      const deletedSnippets = newSnippets.filter(s => s.toDelete);\n\n      // set max-height to current height for CSS transitions\n      deletedSnippets.forEach(s => this.setMaxHeight(s.index));\n      this.setMaxHeight(snippetIndex);\n\n      return new Promise(resolve => {\n        this.setState(\n          ({ additionalLines, snippets }) => {\n            const combinedLines = { ...additionalLines, ...newLinesMapped };\n            return {\n              additionalLines: combinedLines,\n              snippets\n            };\n          },\n          () => {\n            // Set max-height 0 to trigger CSS transitions\n            deletedSnippets.forEach(s => {\n              this.setMaxHeight(s.index, 0);\n            });\n            this.setMaxHeight(snippetIndex, undefined, direction === 'up');\n\n            // Wait for transition to finish before updating dom\n            setTimeout(() => {\n              this.setState({ snippets: newSnippets.filter(s => !s.toDelete) }, resolve);\n              this.cleanDom(snippetIndex);\n            }, 200);\n          }\n        );\n      });\n    }\n    return Promise.resolve();\n  }\n\n  expandComponent = () => {\n    const { branchLike, snippetGroup } = this.props;\n    const { key } = snippetGroup.component;\n\n    this.setState({ loading: true });\n\n    getSources({ key, ...getBranchLikeQuery(branchLike) }).then(\n      lines => {\n        if (this.mounted) {\n          this.setState(({ additionalLines }) => {\n            const combinedLines = { ...additionalLines, ...lines };\n            return {\n              additionalLines: combinedLines,\n              loading: false,\n              snippets: [{ start: 0, end: lines[lines.length - 1].line, index: -1 }]\n            };\n          });\n        }\n      },\n      () => {\n        if (this.mounted) {\n          this.setState({ loading: false });\n        }\n      }\n    );\n  };\n\n  handleLinePopupToggle = (linePopup: T.LinePopup) => {\n    this.props.onLinePopupToggle({\n      ...linePopup,\n      component: this.props.snippetGroup.component.key\n    });\n  };\n\n  handleOpenIssues = (line: T.SourceLine) => {\n    this.setState(state => ({\n      openIssuesByLine: { ...state.openIssuesByLine, [line.line]: true }\n    }));\n  };\n\n  handleCloseIssues = (line: T.SourceLine) => {\n    this.setState(state => ({\n      openIssuesByLine: { ...state.openIssuesByLine, [line.line]: false }\n    }));\n  };\n\n  handleSymbolClick = (highlightedSymbols: string[]) => {\n    this.setState({ highlightedSymbols });\n  };\n\n  loadDuplications = (line: T.SourceLine) => {\n    this.props.loadDuplications(this.props.snippetGroup.component.key, line);\n  };\n\n  renderDuplicationPopup = (index: number, line: number) => {\n    return this.props.renderDuplicationPopup(this.props.snippetGroup.component, index, line);\n  };\n\n  renderSnippet({\n    index,\n    issuesByLine,\n    last,\n    locationsByLine,\n    snippet\n  }: {\n    index: number;\n    issuesByLine: T.IssuesByLine;\n    last: boolean;\n    locationsByLine: { [line: number]: T.LinearIssueLocation[] };\n    snippet: T.SourceLine[];\n  }) {\n    return (\n      <SnippetViewer\n        branchLike={this.props.branchLike}\n        component={this.props.snippetGroup.component}\n        expandBlock={this.expandBlock}\n        handleCloseIssues={this.handleCloseIssues}\n        handleLinePopupToggle={this.handleLinePopupToggle}\n        handleOpenIssues={this.handleOpenIssues}\n        handleSymbolClick={this.handleSymbolClick}\n        highlightedLocationMessage={this.props.highlightedLocationMessage}\n        highlightedSymbols={this.state.highlightedSymbols}\n        index={index}\n        issue={this.props.issue}\n        issuePopup={this.props.issuePopup}\n        issuesByLine={issuesByLine}\n        last={last}\n        linePopup={this.props.linePopup}\n        loadDuplications={this.loadDuplications}\n        locations={this.props.locations}\n        locationsByLine={locationsByLine}\n        onIssueChange={this.props.onIssueChange}\n        onIssuePopupToggle={this.props.onIssuePopupToggle}\n        onLocationSelect={this.props.onLocationSelect}\n        openIssuesByLine={this.state.openIssuesByLine}\n        renderDuplicationPopup={this.renderDuplicationPopup}\n        scroll={this.props.scroll}\n        snippet={snippet}\n      />\n    );\n  }\n\n  render() {\n    const { branchLike, duplications, issue, issuesByLine, last, snippetGroup } = this.props;\n    const { additionalLines, loading, snippets } = this.state;\n    const locations = locationsByLine([issue]);\n\n    const fullyShown =\n      snippets.length === 1 &&\n      snippetGroup.component.measures &&\n      snippets[0].end - snippets[0].start ===\n        parseInt(snippetGroup.component.measures.lines || '', 10);\n\n    const snippetLines = linesForSnippets(snippets, {\n      ...snippetGroup.sources,\n      ...additionalLines\n    });\n\n    return (\n      <div\n        className={classNames('component-source-container', {\n          'source-duplications-expanded': duplications && duplications.length > 0\n        })}\n        ref={this.rootNodeRef}>\n        <SourceViewerHeaderSlim\n          branchLike={branchLike}\n          expandable={!fullyShown}\n          loading={loading}\n          onExpand={this.expandComponent}\n          sourceViewerFile={snippetGroup.component}\n        />\n        {snippetLines.map((snippet, index) => (\n          <div id={`snippet-wrapper-${snippets[index].index}`} key={snippets[index].index}>\n            {this.renderSnippet({\n              snippet,\n              index: snippets[index].index,\n              issuesByLine: last ? issuesByLine : {},\n              locationsByLine: last && index === snippets.length - 1 ? locations : {},\n              last: last && index === snippets.length - 1\n            })}\n          </div>\n        ))}\n      </div>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { Alert } from 'sonar-ui-common/components/ui/Alert';\nimport DeferredSpinner from 'sonar-ui-common/components/ui/DeferredSpinner';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { getDuplications } from '../../../api/components';\nimport { getIssueFlowSnippets } from '../../../api/issues';\nimport throwGlobalError from '../../../app/utils/throwGlobalError';\nimport DuplicationPopup from '../../../components/SourceViewer/components/DuplicationPopup';\nimport {\n  filterDuplicationBlocksByLine,\n  getDuplicationBlocksForIndex,\n  isDuplicationBlockInRemovedComponent\n} from '../../../components/SourceViewer/helpers/duplications';\nimport {\n  duplicationsByLine,\n  issuesByComponentAndLine\n} from '../../../components/SourceViewer/helpers/indexing';\nimport { SourceViewerContext } from '../../../components/SourceViewer/SourceViewerContext';\nimport { WorkspaceContext } from '../../../components/workspace/context';\nimport { getBranchLikeQuery } from '../../../helpers/branch-like';\nimport { BranchLike } from '../../../types/branch-like';\nimport ComponentSourceSnippetViewer from './ComponentSourceSnippetViewer';\nimport { groupLocationsByComponent } from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  highlightedLocationMessage?: { index: number; text: string | undefined };\n  issue: T.Issue;\n  issues: T.Issue[];\n  locations: T.FlowLocation[];\n  onIssueChange: (issue: T.Issue) => void;\n  onLoaded?: () => void;\n  onLocationSelect: (index: number) => void;\n  scroll?: (element: HTMLElement) => void;\n  selectedFlowIndex: number | undefined;\n}\n\ninterface State {\n  components: T.Dict<T.SnippetsByComponent>;\n  duplicatedFiles?: T.Dict<T.DuplicatedFile>;\n  duplications?: T.Duplication[];\n  duplicationsByLine: { [line: number]: number[] };\n  issuePopup?: { issue: string; name: string };\n  linePopup?: T.LinePopup & { component: string };\n  loading: boolean;\n  notAccessible: boolean;\n}\n\nexport default class CrossComponentSourceViewerWrapper extends React.PureComponent<Props, State> {\n  mounted = false;\n  state: State = {\n    components: {},\n    duplicationsByLine: {},\n    loading: true,\n    notAccessible: false\n  };\n\n  componentDidMount() {\n    this.mounted = true;\n    this.fetchIssueFlowSnippets(this.props.issue.key);\n  }\n\n  componentWillReceiveProps(newProps: Props) {\n    if (newProps.issue.key !== this.props.issue.key) {\n      this.fetchIssueFlowSnippets(newProps.issue.key);\n    }\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  fetchDuplications = (component: string, line: T.SourceLine) => {\n    getDuplications({\n      key: component,\n      ...getBranchLikeQuery(this.props.branchLike)\n    }).then(\n      r => {\n        if (this.mounted) {\n          this.setState(state => ({\n            duplicatedFiles: r.files,\n            duplications: r.duplications,\n            duplicationsByLine: duplicationsByLine(r.duplications),\n            linePopup:\n              r.duplications.length === 1\n                ? { component, index: 0, line: line.line, name: 'duplications' }\n                : state.linePopup\n          }));\n        }\n      },\n      () => {}\n    );\n  };\n\n  fetchIssueFlowSnippets(issueKey: string) {\n    this.setState({ loading: true });\n    getIssueFlowSnippets(issueKey).then(\n      components => {\n        if (this.mounted) {\n          this.setState({\n            components,\n            issuePopup: undefined,\n            linePopup: undefined,\n            loading: false\n          });\n          if (this.props.onLoaded) {\n            this.props.onLoaded();\n          }\n        }\n      },\n      (response: Response) => {\n        if (response.status !== 403) {\n          throwGlobalError(response);\n        }\n        if (this.mounted) {\n          this.setState({ loading: false, notAccessible: response.status === 403 });\n        }\n      }\n    );\n  }\n\n  handleIssuePopupToggle = (issue: string, popupName: string, open?: boolean) => {\n    this.setState((state: State) => {\n      const samePopup =\n        state.issuePopup && state.issuePopup.name === popupName && state.issuePopup.issue === issue;\n      if (open !== false && !samePopup) {\n        return { issuePopup: { issue, name: popupName } };\n      } else if (open !== true && samePopup) {\n        return { issuePopup: undefined };\n      }\n      return null;\n    });\n  };\n\n  handleLinePopupToggle = ({\n    component,\n    index,\n    line,\n    name,\n    open\n  }: T.LinePopup & { component: string }) => {\n    this.setState((state: State) => {\n      const samePopup =\n        state.linePopup !== undefined &&\n        state.linePopup.line === line &&\n        state.linePopup.name === name &&\n        state.linePopup.component === component &&\n        state.linePopup.index === index;\n      if (open !== false && !samePopup) {\n        return { linePopup: { component, index, line, name } };\n      } else if (open !== true && samePopup) {\n        return { linePopup: undefined };\n      }\n      return null;\n    });\n  };\n\n  handleCloseLinePopup = () => {\n    this.setState({ linePopup: undefined });\n  };\n\n  renderDuplicationPopup = (component: T.SourceViewerFile, index: number, line: number) => {\n    const { duplicatedFiles, duplications } = this.state;\n\n    if (!component || !duplicatedFiles) {\n      return null;\n    }\n\n    const blocks = getDuplicationBlocksForIndex(duplications, index);\n\n    return (\n      <WorkspaceContext.Consumer>\n        {({ openComponent }) => (\n          <DuplicationPopup\n            blocks={filterDuplicationBlocksByLine(blocks, line)}\n            branchLike={this.props.branchLike}\n            duplicatedFiles={duplicatedFiles}\n            inRemovedComponent={isDuplicationBlockInRemovedComponent(blocks)}\n            onClose={this.handleCloseLinePopup}\n            openComponent={openComponent}\n            sourceViewerFile={component}\n          />\n        )}\n      </WorkspaceContext.Consumer>\n    );\n  };\n\n  render() {\n    const { loading, notAccessible } = this.state;\n\n    if (loading) {\n      return (\n        <div>\n          <DeferredSpinner />\n        </div>\n      );\n    }\n\n    if (notAccessible) {\n      return (\n        <Alert className=\"spacer-top\" variant=\"warning\">\n          {translate('code_viewer.no_source_code_displayed_due_to_security')}\n        </Alert>\n      );\n    }\n\n    const { components, duplications, duplicationsByLine, linePopup } = this.state;\n    const issuesByComponent = issuesByComponentAndLine(this.props.issues);\n    const locationsByComponent = groupLocationsByComponent(this.props.locations, components);\n\n    return (\n      <div>\n        {locationsByComponent.map((snippetGroup, i) => {\n          let componentProps = {};\n          if (linePopup && snippetGroup.component.key === linePopup.component) {\n            componentProps = {\n              duplications,\n              duplicationsByLine,\n              linePopup: { index: linePopup.index, line: linePopup.line, name: linePopup.name }\n            };\n          }\n          return (\n            <SourceViewerContext.Provider\n              key={`${this.props.issue.key}-${this.props.selectedFlowIndex || 0}-${i}`}\n              value={{ branchLike: this.props.branchLike, file: snippetGroup.component }}>\n              <ComponentSourceSnippetViewer\n                branchLike={this.props.branchLike}\n                highlightedLocationMessage={this.props.highlightedLocationMessage}\n                issue={this.props.issue}\n                issuePopup={this.state.issuePopup}\n                issuesByLine={issuesByComponent[snippetGroup.component.key] || {}}\n                last={i === locationsByComponent.length - 1}\n                loadDuplications={this.fetchDuplications}\n                locations={snippetGroup.locations || []}\n                onIssueChange={this.props.onIssueChange}\n                onIssuePopupToggle={this.handleIssuePopupToggle}\n                onLinePopupToggle={this.handleLinePopupToggle}\n                onLocationSelect={this.props.onLocationSelect}\n                renderDuplicationPopup={this.renderDuplicationPopup}\n                scroll={this.props.scroll}\n                snippetGroup={snippetGroup}\n                {...componentProps}\n              />\n            </SourceViewerContext.Provider>\n          );\n        })}\n      </div>\n    );\n  }\n}\n"],"sourceRoot":""}