(window.webpackJsonp=window.webpackJsonp||[]).push([[335],{1770:function(e,t,n){"use strict";n.r(t);var o=n(2),a=n(327),s=n(5),r=n(8),l=n(320);function i(e){return Object(r.getJSON)("/api/webhooks/deliveries",e).catch(l.a)}function c(e){return Object(r.getJSON)("/api/webhooks/delivery",e).catch(l.a)}var d=n(330),h=n(310),u=n(314),m=n.n(u),p=n(1654),b=n.n(p),g=n(1656),k=n.n(g),w=n(604);class f extends o.PureComponent{constructor(){super(...arguments),this.handleCancelClick=e=>{e.preventDefault(),e.currentTarget.blur(),this.props.onClose()},this.handleValidate=e=>{const t=e.name,n=e.secret,o=e.url,a={};return t.trim()||(a.name=Object(s.translate)("webhooks.name.required")),o.trim()?o.startsWith("http://")||o.startsWith("https://")?Object(w.isWebUri)(o)||(a.url=Object(s.translate)("webhooks.url.bad_format")):a.url=Object(s.translate)("webhooks.url.bad_protocol"):a.url=Object(s.translate)("webhooks.url.required"),n&&n.length>200&&(a.secret=Object(s.translate)("webhooks.secret.bad_format")),a}}render(){const e=this.props.webhook,t=!!e,n=t?Object(s.translate)("webhooks.update"):Object(s.translate)("webhooks.create"),a=t?Object(s.translate)("update_verb"):Object(s.translate)("create");return o.createElement(k.a,{confirmButtonText:a,header:n,initialValues:{name:e&&e.name||"",secret:e&&e.secret||"",url:e&&e.url||""},isInitialValid:t,onClose:this.props.onClose,onSubmit:this.props.onDone,size:"small",validate:this.handleValidate},e=>{let t=e.dirty,n=e.errors,a=e.handleBlur,r=e.handleChange,l=e.isSubmitting,i=e.touched,c=e.values;return o.createElement(o.Fragment,null,o.createElement(b.a,{autoFocus:!0,dirty:t,disabled:l,error:n.name,id:"webhook-name",label:o.createElement("label",{htmlFor:"webhook-name"},Object(s.translate)("webhooks.name"),o.createElement("em",{className:"mandatory"},"*")),name:"name",onBlur:a,onChange:r,touched:i.name,type:"text",value:c.name}),o.createElement(b.a,{description:Object(s.translate)("webhooks.url.description"),dirty:t,disabled:l,error:n.url,id:"webhook-url",label:o.createElement("label",{htmlFor:"webhook-url"},Object(s.translate)("webhooks.url"),o.createElement("em",{className:"mandatory"},"*")),name:"url",onBlur:a,onChange:r,touched:i.url,type:"text",value:c.url}),o.createElement(b.a,{description:Object(s.translate)("webhooks.secret.description"),dirty:t,disabled:l,error:n.secret,id:"webhook-secret",label:o.createElement("label",{htmlFor:"webhook-secret"},Object(s.translate)("webhooks.secret")),name:"secret",onBlur:a,onChange:r,touched:i.secret,type:"password",value:c.secret}))})}}const v=10;class E extends o.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={openCreate:!1},this.handleCreateClose=()=>{this.mounted&&this.setState({openCreate:!1})},this.handleCreateOpen=()=>{this.setState({openCreate:!0})},this.renderCreate=()=>this.props.webhooksCount>=v?o.createElement(m.a,{overlay:Object(s.translateWithParameters)("webhooks.maximum_reached",v)},o.createElement(h.Button,{className:"js-webhook-create disabled"},Object(s.translate)("create"))):o.createElement(o.Fragment,null,o.createElement(h.Button,{className:"js-webhook-create",onClick:this.handleCreateOpen},Object(s.translate)("create")),this.state.openCreate&&o.createElement(f,{onClose:this.handleCreateClose,onDone:this.props.onCreate}))}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}render(){return this.props.loading?null:o.createElement("div",{className:"page-actions"},this.renderCreate())}}var y=n(304),O=n(28);function C(e){let t=e.children,n=e.loading;return o.createElement("header",{className:"page-header"},o.createElement("h1",{className:"page-title"},Object(s.translate)("webhooks.page")),n&&o.createElement("i",{className:"spinner"}),t,o.createElement("p",{className:"page-description"},o.createElement(y.FormattedMessage,{defaultMessage:Object(s.translate)("webhooks.description"),id:"webhooks.description",values:{url:o.createElement(O.Link,{to:"/documentation/project-administration/webhooks/"},Object(s.translate)("webhooks.documentation_link"))}})))}var j=n(324),S=n.n(j),N=n(377),D=n.n(N),x=n(333),P=n.n(x),U=n(315),W=n.n(U);function _(e){let t=e.onClose,n=e.onSubmit,a=e.webhook;const r=Object(s.translate)("webhooks.delete");return o.createElement(P.a,{header:r,onClose:t,onSubmit:n},e=>{let t=e.onCloseClick,n=e.onFormSubmit,l=e.submitting;return o.createElement("form",{onSubmit:n},o.createElement("header",{className:"modal-head"},o.createElement("h2",null,r)),o.createElement("div",{className:"modal-body"},Object(s.translateWithParameters)("webhooks.delete.confirm",a.name)),o.createElement("footer",{className:"modal-foot"},o.createElement(W.a,{className:"spacer-right",loading:l}),o.createElement(h.SubmitButton,{className:"button-red",disabled:l},Object(s.translate)("delete")),o.createElement(h.ResetButtonLink,{disabled:l,onClick:t},Object(s.translate)("cancel"))))})}var M=n(356),B=n.n(M),L=n(326),F=n.n(L),J=n(613),I=n.n(J),z=n(508),A=n.n(z),R=n(440),V=n.n(R),q=n(342),H=n(317),T=n(537);function G(e){let t=e.className,n=e.delivery,a=e.loading,r=e.payload;return o.createElement("div",{className:t},o.createElement("p",{className:"spacer-bottom"},Object(s.translateWithParameters)("webhooks.delivery.response_x",n.httpStatus||Object(s.translate)("webhooks.delivery.server_unreachable"))),o.createElement("p",{className:"spacer-bottom"},Object(s.translateWithParameters)("webhooks.delivery.duration_x",Object(H.formatMeasure)(n.durationMs,"MILLISEC"))),o.createElement("p",{className:"spacer-bottom"},Object(s.translate)("webhooks.delivery.payload")),o.createElement(W.a,{className:"spacer-left spacer-top",loading:a},r&&o.createElement(T.a,{noCopy:!0,snippet:K(r)})))}function K(e){try{return JSON.stringify(JSON.parse(e),void 0,2)}catch(t){return e}}class Q extends o.PureComponent{constructor(){var e;super(...arguments),e=this,this.mounted=!1,this.state={loading:!1,open:!1},this.fetchPayload=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.props,n=t.delivery;return e.setState({loading:!0}),c({deliveryId:n.id}).then(t=>{let n=t.delivery;e.mounted&&e.setState({payload:n.payload,loading:!1})},()=>{e.mounted&&e.setState({loading:!1})})},this.formatPayload=e=>{try{return JSON.stringify(JSON.parse(e),void 0,2)}catch(t){return e}},this.handleClick=()=>{this.state.payload||this.fetchPayload(),this.setState(e=>{return{open:!e.open}})}}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}render(){const e=this.props.delivery,t=this.state,n=t.loading,a=t.open,s=t.payload;return o.createElement(I.a,{onClick:this.handleClick,open:a,renderHeader:()=>e.success?o.createElement(V.a,{className:"pull-right js-success"}):o.createElement(A.a,{className:"pull-right js-error"}),title:o.createElement(q.a,{date:e.at})},o.createElement(G,{className:"big-spacer-left",delivery:e,loading:n,payload:s}))}}const X=10;class Y extends o.PureComponent{constructor(){var e;super(...arguments),e=this,this.mounted=!1,this.state={deliveries:[],loading:!0},this.fetchDeliveries=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.props,n=t.webhook;i({webhook:n.key,ps:X}).then(t=>{let n=t.deliveries,o=t.paging;e.mounted&&e.setState({deliveries:n,loading:!1,paging:o})},e.stopLoading)},this.fetchMoreDeliveries=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.props,n=t.webhook;const o=e.state.paging;o&&(e.setState({loading:!0}),i({webhook:n.key,p:o.pageIndex+1,ps:X}).then(t=>{let n=t.deliveries,o=t.paging;e.mounted&&e.setState(e=>({deliveries:[...e.deliveries,...n],loading:!1,paging:o}))},e.stopLoading))},this.stopLoading=()=>{this.mounted&&this.setState({loading:!1})}}componentDidMount(){this.mounted=!0,this.fetchDeliveries()}componentWillUnmount(){this.mounted=!1}render(){const e=this.props.webhook,t=this.state,n=t.deliveries,a=t.loading,r=t.paging,l=Object(s.translateWithParameters)("webhooks.deliveries_for_x",e.name);return o.createElement(F.a,{contentLabel:l,onRequestClose:this.props.onClose},o.createElement("header",{className:"modal-head"},o.createElement("h2",null,l)),o.createElement("div",{className:"modal-body modal-container"},n.map(e=>o.createElement(Q,{delivery:e,key:e.id})),o.createElement("div",{className:"text-center"},o.createElement(W.a,{loading:a})),void 0!==r&&o.createElement(B.a,{className:"little-spacer-bottom",count:n.length,loadMore:this.fetchMoreDeliveries,ready:!a,total:r.total})),o.createElement("footer",{className:"modal-foot"},o.createElement(h.ResetButtonLink,{className:"js-modal-close",onClick:this.props.onClose},Object(s.translate)("close"))))}}function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class $ extends o.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={deleting:!1,deliveries:!1,updating:!1},this.handleDelete=()=>this.props.onDelete(this.props.webhook.key),this.handleDeleteClick=()=>{this.setState({deleting:!0})},this.handleDeletingStop=()=>{this.mounted&&this.setState({deleting:!1})},this.handleDeliveriesClick=()=>{this.setState({deliveries:!0})},this.handleDeliveriesStop=()=>{this.setState({deliveries:!1})},this.handleUpdate=e=>this.props.onUpdate(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){Z(e,t,n[t])})}return e}({},e,{webhook:this.props.webhook.key})),this.handleUpdateClick=()=>{this.setState({updating:!0})},this.handleUpdatingStop=()=>{this.setState({updating:!1})}}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}render(){const e=this.props.webhook;return o.createElement(o.Fragment,null,o.createElement(D.a,{className:"big-spacer-left"},o.createElement(N.ActionsDropdownItem,{className:"js-webhook-update",onClick:this.handleUpdateClick},Object(s.translate)("update_verb")),e.latestDelivery&&o.createElement(N.ActionsDropdownItem,{className:"js-webhook-deliveries",onClick:this.handleDeliveriesClick},Object(s.translate)("webhooks.deliveries.show")),o.createElement(N.ActionsDropdownDivider,null),o.createElement(N.ActionsDropdownItem,{className:"js-webhook-delete",destructive:!0,onClick:this.handleDeleteClick},Object(s.translate)("delete"))),this.state.deliveries&&o.createElement(Y,{onClose:this.handleDeliveriesStop,webhook:e}),this.state.updating&&o.createElement(f,{onClose:this.handleUpdatingStop,onDone:this.handleUpdate,webhook:e}),this.state.deleting&&o.createElement(_,{onClose:this.handleDeletingStop,onSubmit:this.handleDelete,webhook:e}))}}var ee=n(577),te=n.n(ee);class ne extends o.PureComponent{constructor(){var e;super(...arguments),e=this,this.mounted=!1,this.state={loading:!0},this.fetchPayload=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.props,n=t.delivery;return c({deliveryId:n.id}).then(t=>{let n=t.delivery;e.mounted&&e.setState({payload:n.payload,loading:!1})},()=>{e.mounted&&e.setState({loading:!1})})},this.formatPayload=e=>{try{return JSON.stringify(JSON.parse(e),void 0,2)}catch(t){return e}}}componentDidMount(){this.mounted=!0,this.fetchPayload()}componentWillUnmount(){this.mounted=!1}render(){const e=this.props,t=e.delivery,n=e.webhook,a=this.state,r=a.loading,l=a.payload,i=Object(s.translateWithParameters)("webhooks.latest_delivery_for_x",n.name);return o.createElement(F.a,{contentLabel:i,onRequestClose:this.props.onClose},o.createElement("header",{className:"modal-head"},o.createElement("h2",null,i)),o.createElement(G,{className:"modal-body modal-container",delivery:t,loading:r,payload:l}),o.createElement("footer",{className:"modal-foot"},o.createElement(h.ResetButtonLink,{className:"js-modal-close",onClick:this.props.onClose},Object(s.translate)("close"))))}}class oe extends o.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={modal:!1},this.handleClick=()=>{this.setState({modal:!0})},this.handleModalClose=()=>{this.mounted&&this.setState({modal:!1})}}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}render(){const e=this.props.webhook;if(!e.latestDelivery)return o.createElement("span",null,Object(s.translate)("webhooks.last_execution.none"));const t=this.state.modal;return o.createElement(o.Fragment,null,e.latestDelivery.success?o.createElement(V.a,{className:"text-text-top"}):o.createElement(A.a,{className:"text-text-top"}),o.createElement("span",{className:"spacer-left display-inline-flex-center"},o.createElement(q.a,{date:e.latestDelivery.at}),o.createElement(h.ButtonIcon,{className:"button-small little-spacer-left",onClick:this.handleClick},o.createElement(te.a,null))),t&&o.createElement(ne,{delivery:e.latestDelivery,onClose:this.handleModalClose,webhook:e}))}}function ae(e){let t=e.onDelete,n=e.onUpdate,a=e.webhook;return o.createElement("tr",null,o.createElement("td",null,a.name),o.createElement("td",null,a.url),o.createElement("td",null,a.secret?Object(s.translate)("yes"):Object(s.translate)("no")),o.createElement("td",null,o.createElement(oe,{webhook:a})),o.createElement("td",{className:"thin nowrap text-right"},o.createElement($,{onDelete:t,onUpdate:n,webhook:a})))}class se extends o.PureComponent{constructor(){super(...arguments),this.renderHeader=()=>o.createElement("thead",null,o.createElement("tr",null,o.createElement("th",null,Object(s.translate)("name")),o.createElement("th",null,Object(s.translate)("webhooks.url")),o.createElement("th",null,Object(s.translate)("webhooks.secret_header")),o.createElement("th",null,Object(s.translate)("webhooks.last_execution")),o.createElement("th",null)))}render(){const e=this.props.webhooks;return e.length<1?o.createElement("p",null,Object(s.translate)("webhooks.no_result")):o.createElement("table",{className:"data zebra"},this.renderHeader(),o.createElement("tbody",null,S()(e,e=>e.name.toLowerCase()).map(e=>o.createElement(ae,{key:e.key,onDelete:this.props.onDelete,onUpdate:this.props.onUpdate,webhook:e}))))}}function re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){le(e,t,n[t])})}return e}function le(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"default",function(){return ie});class ie extends o.PureComponent{constructor(){var e;super(...arguments),e=this,this.mounted=!1,this.state={loading:!0,webhooks:[]},this.fetchWebhooks=()=>(function(e){return Object(r.getJSON)("/api/webhooks/list",e).catch(l.a)})(this.getScopeParams()).then(e=>{let t=e.webhooks;this.mounted&&this.setState({loading:!1,webhooks:t})},()=>{this.mounted&&this.setState({loading:!1})}),this.getScopeParams=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.props,n=t.organization,o=t.component;const a=n&&n.key;return{organization:o?o.organization:a,project:o&&o.key}},this.handleCreate=e=>{return function(e){return Object(r.postJSON)("/api/webhooks/create",e).catch(l.a)}(re({name:e.name,url:e.url},e.secret&&{secret:e.secret},this.getScopeParams())).then(e=>{let t=e.webhook;this.mounted&&this.setState(e=>{return{webhooks:[...e.webhooks,t]}})})},this.handleDelete=e=>(function(e){return Object(r.post)("/api/webhooks/delete",e).catch(l.a)})({webhook:e}).then(()=>{this.mounted&&this.setState(t=>{return{webhooks:t.webhooks.filter(t=>t.key!==e)}})}),this.handleUpdate=e=>{return function(e){return Object(r.post)("/api/webhooks/update",e).catch(l.a)}(re({webhook:e.webhook,name:e.name,url:e.url},e.secret&&{secret:e.secret})).then(()=>{this.mounted&&this.setState(t=>{return{webhooks:t.webhooks.map(t=>t.key===e.webhook?re({},t,{name:e.name,secret:e.secret,url:e.url}):t)}})})}}componentDidMount(){this.mounted=!0,this.fetchWebhooks()}componentWillUnmount(){this.mounted=!1}render(){const e=this.state,t=e.loading,n=e.webhooks;return o.createElement(o.Fragment,null,o.createElement(d.a,{suggestions:"webhooks"}),o.createElement(a.a,{defer:!1,title:Object(s.translate)("webhooks.page")}),o.createElement("div",{className:"page page-limited"},o.createElement(C,{loading:t},o.createElement(E,{loading:t,onCreate:this.handleCreate,webhooksCount:n.length})),!t&&o.createElement("div",{className:"boxed-group boxed-group-inner"},o.createElement(se,{onDelete:this.handleDelete,onUpdate:this.handleUpdate,webhooks:n}))))}}},330:function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(2),a=n(355);function s(e){let t=e.suggestions;return o.createElement(a.a.Consumer,null,e=>{let n=e.addSuggestions,a=e.removeSuggestions;return o.createElement(r,{addSuggestions:n,removeSuggestions:a,suggestions:t})})}class r extends o.PureComponent{componentDidMount(){this.props.addSuggestions(this.props.suggestions)}componentDidUpdate(e){e.suggestions!==this.props.suggestions&&(this.props.removeSuggestions(this.props.suggestions),this.props.addSuggestions(e.suggestions))}componentWillUnmount(){this.props.removeSuggestions(this.props.suggestions)}render(){return null}}},342:function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"a",function(){return l});var o=n(2),a=n(304),s=n(29);const r={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"};function l(e){let t=e.children,n=e.date;return o.createElement(a.FormattedDate,Object.assign({value:Object(s.parseDate)(n)},r),t)}},537:function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(309),a=n(2),s=n(375);n(696);const r=" \\\n  ";function l(e){let t=e.className,n=e.isOneLine,l=e.noCopy,i=e.render,c=e.snippet,d=e.wrap;const h=Array.isArray(c)?c.filter(e=>void 0!==e):[c],u=n?h.join(" "):h.join(r);return a.createElement("div",{className:o("code-snippet",{"code-snippet-oneline":n,"code-snippet-wrap":d},t)},a.createElement("pre",null,i?i():u),!l&&a.createElement(s.ClipboardButton,{copyValue:u}))}},696:function(e,t,n){var o=n(697);"string"==typeof o&&(o=[[e.i,o,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};n(312)(o,a);o.locals&&(e.exports=o.locals)},697:function(e,t,n){(e.exports=n(311)(!1)).push([e.i,".code-snippet{position:relative;margin:8px 0;background:#404040;color:#f0f0f0;border-radius:3px}.code-snippet pre{padding:16px;overflow:auto}.code-snippet>button{position:absolute;top:16px;right:16px;line-height:18px;border:1px solid #fff;color:#fff;font-size:11px;font-weight:400;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.code-snippet>button:active,.code-snippet>button:focus,.code-snippet>button:hover{background-color:#fff;color:#404040}.code-snippet-oneline pre{padding-bottom:40px}.code-snippet-oneline>button{top:auto;bottom:16px}.code-snippet-wrap pre{white-space:pre-wrap;word-break:break-all}.code-snippet .highlight{font-weight:700;color:#f4b1b0}.code-snippet .button-icon{color:#fff!important}.code-snippet .button-icon:active svg,.code-snippet .button-icon:focus svg,.code-snippet .button-icon:hover svg{background-color:#fff;color:#404040}",""])}}]);
//# sourceMappingURL=335.m.51f346c5.chunk.js.map