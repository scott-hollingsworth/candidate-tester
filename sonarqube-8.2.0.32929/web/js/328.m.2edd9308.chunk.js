(window.webpackJsonp=window.webpackJsonp||[]).push([[328],{1738:function(e,t,a){"use strict";a.r(t),a.d(t,"default",function(){return r});var n=a(2),s=a(945);function r(e){return n.createElement(s.a,Object.assign({setup:!1},e))}},359:function(e,t,a){"use strict";a.d(t,"a",function(){return c});var n=a(2),s=a(304),r=a(29);function c(e){let t=e.children,a=e.date;return n.createElement(s.FormattedRelative,{value:Object(r.parseDate)(a)},t)}},518:function(e,t,a){"use strict";a.d(t,"g",function(){return r}),a.d(t,"b",function(){return c}),a.d(t,"c",function(){return i}),a.d(t,"d",function(){return l}),a.d(t,"a",function(){return m}),a.d(t,"e",function(){return u}),a.d(t,"f",function(){return o}),a.d(t,"h",function(){return d});var n=a(8),s=a(320);function r(e){return Object(n.post)("/api/system/change_log_level",{level:e}).catch(s.a)}function c(){return Object(n.getJSON)("/api/system/info").catch(s.a)}function i(){return Object(n.getJSON)("/api/system/status")}function l(){return Object(n.getJSON)("/api/system/upgrades")}function m(){return Object(n.getJSON)("/api/system/db_migration_status")}function u(){return Object(n.postJSON)("/api/system/migrate_db")}function o(){return Object(n.post)("/api/system/restart").catch(s.a)}function d(){return Object(n.requestTryAndRepeatUntil)(i,{max:-1,slowThreshold:-15},e=>{return"UP"===e.status})}},558:function(e,t,a){"use strict";a.d(t,"a",function(){return l});var n=a(2),s=a(304),r=a(29);const c={hour:"numeric",minute:"numeric"},i={hour:"numeric",minute:"numeric",second:"numeric"};function l(e){let t=e.children,a=e.date,l=e.long;return n.createElement(s.FormattedTime,Object.assign({value:Object(r.parseDate)(a)},l?i:c),t)}},945:function(e,t,a){"use strict";a.d(t,"a",function(){return p});var n=a(309),s=a(2),r=a(327),c=a(304),i=a(310),l=a(5),m=a(335),u=a(518),o=a(409),d=a(359),h=a(558),g=a(22);a(946);class p extends s.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={},this.fetchStatus=()=>{(this.props.setup?this.fetchMigrationState():this.fetchSystemStatus()).catch(()=>{this.mounted&&this.setState({message:void 0,startedAt:void 0,state:void 0,status:"OFFLINE"})})},this.fetchSystemStatus=()=>Object(u.c)().then(e=>{let t=e.status;this.mounted&&(this.setState({status:t}),"STARTING"===t?(this.setState({wasStarting:!0}),this.scheduleRefresh()):"UP"===t?this.state.wasStarting&&this.loadPreviousPage():this.scheduleRefresh())}),this.fetchMigrationState=()=>Object(u.a)().then(e=>{let t=e.message,a=e.startedAt,n=e.state;this.mounted&&(this.setState({message:t,startedAt:a,state:n}),"MIGRATION_SUCCEEDED"===n?this.loadPreviousPage():"NO_MIGRATION"!==n&&this.scheduleRefresh())}),this.scheduleRefresh=()=>{this.interval=window.setTimeout(this.fetchStatus,5e3)},this.loadPreviousPage=()=>{setInterval(()=>{window.location.href=Object(m.getReturnUrl)(this.props.location)},2500)},this.handleMigrateClick=()=>{Object(u.e)().then(e=>{let t=e.message,a=e.startedAt,n=e.state;this.mounted&&this.setState({message:t,startedAt:a,state:n})},()=>{})}}componentDidMount(){this.mounted=!0,this.fetchStatus()}componentWillUnmount(){this.mounted=!1,this.interval&&window.clearInterval(this.interval)}render(){const e=this.state,t=e.state,a=e.status;return s.createElement(s.Fragment,null,s.createElement(r.a,{defaultTitle:Object(l.translate)("maintenance.page"),defer:!1}),s.createElement("div",{className:"page-wrapper-simple",id:"bd"},s.createElement("div",{className:n("page-simple",{"panel-warning":"MIGRATION_REQUIRED"===t}),id:"nonav"},"OFFLINE"===a&&s.createElement(s.Fragment,null,s.createElement("h1",{className:"maintenance-title text-danger"},s.createElement(o.a,{message:Object(l.translate)("maintenance.is_offline")})),!Object(g.isSonarCloud)()&&s.createElement("p",{className:"maintenance-text"},Object(l.translate)("maintenance.sonarqube_is_offline.text")),s.createElement("p",{className:"maintenance-text text-center"},s.createElement("a",{href:Object(m.getBaseUrl)()+"/"},Object(l.translate)("maintenance.try_again")))),"UP"===a&&s.createElement(s.Fragment,null,s.createElement("h1",{className:"maintenance-title"},s.createElement(o.a,{message:Object(l.translate)("maintenance.is_up")})),s.createElement("p",{className:"maintenance-text text-center"},Object(l.translate)("maintenance.all_systems_opetational")),s.createElement("p",{className:"maintenance-text text-center"},s.createElement("a",{href:Object(m.getBaseUrl)()+"/"},Object(l.translate)("layout.home")))),"STARTING"===a&&s.createElement(s.Fragment,null,s.createElement("h1",{className:"maintenance-title"},s.createElement(o.a,{message:Object(l.translate)("maintenance.is_starting")})),s.createElement("p",{className:"maintenance-spinner"},s.createElement("i",{className:"spinner"}))),"DOWN"===a&&s.createElement(s.Fragment,null,s.createElement("h1",{className:"maintenance-title text-danger"},s.createElement(o.a,{message:Object(l.translate)("maintenance.is_down")})),s.createElement("p",{className:"maintenance-text"},Object(l.translate)("maintenance.sonarqube_is_down.text")),s.createElement("p",{className:"maintenance-text text-center"},s.createElement("a",{href:Object(m.getBaseUrl)()+"/"},Object(l.translate)("maintenance.try_again")))),("DB_MIGRATION_NEEDED"===a||"DB_MIGRATION_RUNNING"===a)&&s.createElement(s.Fragment,null,s.createElement("h1",{className:"maintenance-title"},s.createElement(o.a,{message:Object(l.translate)("maintenance.is_under_maintenance")})),!Object(g.isSonarCloud)()&&s.createElement(s.Fragment,null,s.createElement("p",{className:"maintenance-text"},s.createElement(c.FormattedMessage,{defaultMessage:Object(l.translate)("maintenance.sonarqube_is_under_maintenance.1"),id:"maintenance.sonarqube_is_under_maintenance.1",values:{link:s.createElement("a",{href:"https://redirect.sonarsource.com/doc/plugin-library.html"},Object(l.translate)("maintenance.sonarqube_is_under_maintenance_link.1"))}})),s.createElement("p",{className:"maintenance-text"},s.createElement(c.FormattedMessage,{defaultMessage:Object(l.translate)("maintenance.sonarqube_is_under_maintenance.2"),id:"maintenance.sonarqube_is_under_maintenance.2",values:{link:s.createElement("a",{href:"https://redirect.sonarsource.com/doc/upgrading.html"},Object(l.translate)("maintenance.sonarqube_is_under_maintenance_link.2"))}})))),"NO_MIGRATION"===t&&s.createElement(s.Fragment,null,s.createElement("h1",{className:"maintenance-title"},Object(l.translate)("maintenance.database_is_up_to_date")),s.createElement("p",{className:"maintenance-text text-center"},s.createElement("a",{href:Object(m.getBaseUrl)()+"/"},Object(l.translate)("layout.home")))),"MIGRATION_REQUIRED"===t&&s.createElement(s.Fragment,null,s.createElement("h1",{className:"maintenance-title"},Object(l.translate)("maintenance.upgrade_database")),s.createElement("p",{className:"maintenance-text"},Object(l.translate)("maintenance.upgrade_database.1")),s.createElement("p",{className:"maintenance-text"},Object(l.translate)("maintenance.upgrade_database.2")),s.createElement("p",{className:"maintenance-text"},Object(l.translate)("maintenance.upgrade_database.3")),s.createElement("div",{className:"maintenance-spinner"},s.createElement(i.Button,{id:"start-migration",onClick:this.handleMigrateClick},Object(l.translate)("maintenance.upgrade")))),"NOT_SUPPORTED"===t&&s.createElement(s.Fragment,null,s.createElement("h1",{className:"maintenance-title text-danger"},Object(l.translate)("maintenance.migration_not_supported")),s.createElement("p",null,Object(l.translate)("maintenance.migration_not_supported.text"))),"MIGRATION_RUNNING"===t&&s.createElement(s.Fragment,null,s.createElement("h1",{className:"maintenance-title"},Object(l.translate)("maintenance.database_migration")),this.state.message&&s.createElement("p",{className:"maintenance-text text-center"},this.state.message),this.state.startedAt&&s.createElement("p",{className:"maintenance-text text-center"},Object(l.translate)("background_tasks.table.started")," ",s.createElement(d.a,{date:this.state.startedAt}),s.createElement("br",null),s.createElement("small",{className:"text-muted"},s.createElement(h.a,{date:this.state.startedAt,long:!0}))),s.createElement("p",{className:"maintenance-spinner"},s.createElement("i",{className:"spinner"}))),"MIGRATION_SUCCEEDED"===t&&s.createElement(s.Fragment,null,s.createElement("h1",{className:"maintenance-title text-success"},Object(l.translate)("maintenance.database_is_up_to_date")),s.createElement("p",{className:"maintenance-text text-center"},s.createElement("a",{href:Object(m.getBaseUrl)()+"/"},Object(l.translate)("layout.home")))),"MIGRATION_FAILED"===t&&s.createElement(s.Fragment,null,s.createElement("h1",{className:"maintenance-title text-danger"},Object(l.translate)("maintenance.upgrade_failed")),s.createElement("p",{className:"maintenance-text"},Object(l.translate)("maintenance.upgrade_failed.text"))))))}}},946:function(e,t,a){var n=a(947);"string"==typeof n&&(n=[[e.i,n,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};a(312)(n,s);n.locals&&(e.exports=n.locals)},947:function(e,t,a){(e.exports=a(311)(!1)).push([e.i,".maintenance-title{margin-bottom:40px;line-height:1.5;font-size:24px;font-weight:300;text-align:center}.maintenance-text{margin-bottom:16px;line-height:1.5;font-size:16px;font-weight:300}.maintenance-spinner{margin-top:40px;text-align:center}",""])}}]);
//# sourceMappingURL=328.m.2edd9308.chunk.js.map